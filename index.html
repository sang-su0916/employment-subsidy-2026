<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ê³ ìš©ì§€ì›ê¸ˆ ì‹ ì²­ê°€ëŠ¥ í™•ì¸ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold-brown: #C8A97E;
            --gold-light: #D4B896;
            --gold-dark: #A8875E;
            --charcoal: #3D3D3D;
            --charcoal-dark: #2D2D2D;
            --charcoal-light: #4D4D4D;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--charcoal) 0%, var(--charcoal-dark) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        .card h2 {
            color: var(--charcoal);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gold-brown);
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        label {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label span {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }
        select, input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        select:focus, input:focus {
            outline: none;
            border-color: var(--gold-brown);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--gold-brown) 0%, var(--gold-dark) 100%);
            color: white;
        }
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        .btn-success {
            background: #34a853;
            color: white;
        }
        .btn-danger {
            background: #ea4335;
            color: white;
        }
        .hidden { display: none; }
        .results-summary {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--charcoal) 0%, var(--charcoal-dark) 100%);
            border-radius: 12px;
            color: white;
            margin-bottom: 20px;
            border: 2px solid var(--gold-brown);
        }
        .results-summary h3 {
            color: var(--gold-light);
        }
        .results-summary .amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: var(--gold-brown);
        }
        .subsidy-list { list-style: none; }
        .subsidy-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .subsidy-item.eligible {
            background: #e6f4ea;
            border-color: #34a853;
        }
        .subsidy-item.not-eligible {
            background: #fce8e6;
            border-color: #ea4335;
        }
        .subsidy-item h4 { margin-bottom: 5px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .subsidy-item p { color: #666; font-size: 0.9rem; }
        .verification-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-confirmed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .badge-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .verification-source {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--gold-brown);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .header {
            background: white;
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .header-logo {
            height: 160px;
            width: auto;
            object-fit: contain;
        }
        .header-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-align: center;
        }
        .header-company {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--charcoal);
            letter-spacing: -0.5px;
        }
        .header-contact {
            font-size: 1rem;
            font-weight: 600;
            color: #555;
        }
        .header-contact a {
            color: var(--gold-dark);
            text-decoration: none;
            font-weight: 600;
        }
        .header-contact a:hover {
            text-decoration: underline;
            color: var(--gold-brown);
        }
        .btn-apply {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
            border: none;
        }
        .btn-apply:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.5);
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.5rem; }
            .results-summary .amount { font-size: 1.8rem; }
            .header {
                flex-direction: column;
                text-align: center;
            }
            .header-left {
                flex-direction: column;
            }
            .header-logo {
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <img src="logo.jpeg" alt="ë…¸ë¬´ë²•ì¸ ê°™ì´" class="header-logo">
                <div class="header-info">
                    <span class="header-company">ë…¸ë¬´ë²•ì¸ ê°™ì´</span>
                    <span class="header-contact">ì§€ì›ê¸ˆ ë¬¸ì˜ <a href="tel:02-6949-4974">02-6949-4974</a></span>
                </div>
            </div>
            <a href="https://forms.gle/6jGEKetXCeoSAQXg7" target="_blank" class="btn-apply">
                ì§€ì›ê¸ˆ ì‹ ì²­í•˜ê¸° â†’
            </a>
        </div>
        <h1>2026 ê³ ìš©ì§€ì›ê¸ˆ ì‹ ì²­ê°€ëŠ¥ í™•ì¸ ì‹œìŠ¤í…œ</h1>

        <div class="card">
            <h2>ê¸°ì—… ì •ë³´ ì…ë ¥</h2>
            <form id="companyForm">
                <div class="form-grid">
                    <label style="grid-column: 1 / -1;">
                        <span>íšŒì‚¬ëª… (ì„ íƒì‚¬í•­ - PDF ë³´ê³ ì„œì— í‘œì‹œ)</span>
                        <input type="text" id="companyName" placeholder="ì˜ˆ: (ì£¼)ABCê¸°ì—…" style="max-width: 400px;">
                    </label>
                    <label>
                        <span>ì§€ì—­</span>
                        <select id="region" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì„œìš¸">ì„œìš¸</option>
                            <option value="ê²½ê¸°">ê²½ê¸°</option>
                            <option value="ì¸ì²œ">ì¸ì²œ</option>
                            <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                            <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                            <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                            <option value="ëŒ€ì „">ëŒ€ì „</option>
                            <option value="ìš¸ì‚°">ìš¸ì‚°</option>
                            <option value="ì„¸ì¢…">ì„¸ì¢…</option>
                            <option value="ê°•ì›">ê°•ì›</option>
                            <option value="ì¶©ë¶">ì¶©ë¶</option>
                            <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
                            <option value="ì „ë¶">ì „ë¶</option>
                            <option value="ì „ë‚¨">ì „ë‚¨</option>
                            <option value="ê²½ë¶">ê²½ë¶</option>
                            <option value="ê²½ë‚¨">ê²½ë‚¨</option>
                            <option value="ì œì£¼">ì œì£¼</option>
                        </select>
                    </label>
                    <label>
                        <span>ì§€ì—­ ìœ í˜•</span>
                        <select id="regionType" required>
                            <option value="ìˆ˜ë„ê¶Œ">ìˆ˜ë„ê¶Œ</option>
                            <option value="ë¹„ìˆ˜ë„ê¶Œ">ë¹„ìˆ˜ë„ê¶Œ</option>
                        </select>
                    </label>
                    <label>
                        <span>ì—…ì¢…</span>
                        <select id="industry" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì œì¡°ì—…">ì œì¡°ì—…</option>
                            <option value="ê±´ì„¤ì—…">ê±´ì„¤ì—…</option>
                            <option value="ë„ì†Œë§¤ì—…">ë„ì†Œë§¤ì—…</option>
                            <option value="ìˆ™ë°•ìŒì‹ì—…">ìˆ™ë°•ìŒì‹ì—…</option>
                            <option value="ì •ë³´í†µì‹ ì—…">ì •ë³´í†µì‹ ì—…</option>
                            <option value="ì „ë¬¸ê³¼í•™ê¸°ìˆ ì—…">ì „ë¬¸ê³¼í•™ê¸°ìˆ ì—…</option>
                            <option value="ì‚¬ì—…ì„œë¹„ìŠ¤ì—…">ì‚¬ì—…ì„œë¹„ìŠ¤ì—…</option>
                            <option value="ë†ì—…/ì„ì—…/ì–´ì—…">ë†ì—…/ì„ì—…/ì–´ì—…</option>
                            <option value="ê´‘ì—…">ê´‘ì—…</option>
                            <option value="ì „ê¸°/ê°€ìŠ¤/ìˆ˜ë„">ì „ê¸°/ê°€ìŠ¤/ìˆ˜ë„</option>
                            <option value="ìš´ìˆ˜/ì°½ê³ ì—…">ìš´ìˆ˜/ì°½ê³ ì—…</option>
                            <option value="ê¸ˆìœµ/ë³´í—˜ì—…">ê¸ˆìœµ/ë³´í—˜ì—…</option>
                            <option value="ë¶€ë™ì‚°ì—…">ë¶€ë™ì‚°ì—…</option>
                            <option value="êµìœ¡ì„œë¹„ìŠ¤ì—…">êµìœ¡ì„œë¹„ìŠ¤ì—…</option>
                            <option value="ë³´ê±´/ì‚¬íšŒë³µì§€">ë³´ê±´/ì‚¬íšŒë³µì§€</option>
                            <option value="ì˜ˆìˆ /ìŠ¤í¬ì¸ ">ì˜ˆìˆ /ìŠ¤í¬ì¸ </option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </label>
                    <label>
                        <span>ì´ ì§ì›ìˆ˜</span>
                        <input type="number" id="totalEmployees" min="1" value="10" required>
                    </label>
                    <label>
                        <span>ì²­ë…„ (15~34ì„¸)</span>
                        <input type="number" id="youthEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ì¤‘ì¥ë…„ (50~59ì„¸)</span>
                        <input type="number" id="middleAgedEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ê³ ë ¹ì (60ì„¸+)</span>
                        <input type="number" id="seniorEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ì¥ì• ì¸</span>
                        <input type="number" id="disabledEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ì¤‘ì¦ì¥ì• ì¸</span>
                        <input type="number" id="severeDisabledEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ìœ¡ì•„ê¸° ê·¼ë¡œì</span>
                        <input type="number" id="childcareWorkers" min="0" value="0">
                    </label>
                    <label>
                        <span>ë¹„ì •ê·œì§ (ì „í™˜ ì˜ˆì •)</span>
                        <input type="number" id="nonRegularEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ (50ì„¸+)</span>
                        <input type="number" id="trainedMiddleAged" min="0" value="0" title="í´ë¦¬í… ì¤‘ì¥ë…„ íŠ¹í™”ê³¼ì •, êµ­ê°€ê¸°ê°„Â·ì „ëµì‚°ì—…ì§ì¢… í›ˆë ¨, ì¤‘ì¥ë…„ê²½ë ¥ì§€ì›ì œ ìˆ˜ë£Œì">
                    </label>
                    <label>
                        <span>ì •ë…„ ê·œì • ìœ ë¬´</span>
                        <select id="hasRetirementAge">
                            <option value="false">ì—†ìŒ</option>
                            <option value="true">ìˆìŒ</option>
                        </select>
                    </label>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn-primary">ì§€ì›ê¸ˆ ë¶„ì„í•˜ê¸°</button>
                    <button type="reset" class="btn-secondary">ì´ˆê¸°í™”</button>
                </div>
            </form>
        </div>

        <div id="results" class="hidden">
            <div class="card">
                <div class="results-summary">
                    <h3>ì´ ì˜ˆìƒ ìˆ˜ê¸‰ì•¡</h3>
                    <div class="amount" id="totalAmount">0ì›</div>
                    <p>ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ <span id="eligibleCount">0</span>ê°œ</p>
                </div>

                <div class="btn-group" style="justify-content: center;">
                    <button id="exportExcel" class="btn-success">Excel ë‹¤ìš´ë¡œë“œ</button>
                    <button id="exportPdf" class="btn-danger">PDF ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>

            <div class="card">
                <h2>ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ</h2>
                <ul class="subsidy-list" id="eligibleList"></ul>
            </div>

            <div class="card">
                <h2>ì§€ì›ê¸ˆ ë¹„êµ</h2>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ</h2>
                <ul class="subsidy-list" id="notEligibleList"></ul>
            </div>
        </div>

    </div>

    <script>
        let currentResults = null;
        let subsidyData = null;
        let chart = null;

        // ì§€ì›ê¸ˆ ë°ì´í„° ë¡œë“œ
        async function loadSubsidyData() {
            const response = await fetch('/subsidies-2026.json');
            subsidyData = await response.json();
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            await loadSubsidyData();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('companyForm').addEventListener('submit', handleSubmit);
            document.getElementById('companyForm').addEventListener('reset', handleReset);
            document.getElementById('exportExcel').addEventListener('click', exportExcel);
            document.getElementById('exportPdf').addEventListener('click', exportPdf);

            // ì§€ì—­ ì„ íƒ ì‹œ ì§€ì—­ ìœ í˜• ìë™ ì„¤ì •
            document.getElementById('region').addEventListener('change', (e) => {
                const metro = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ'];
                document.getElementById('regionType').value = metro.includes(e.target.value) ? 'ìˆ˜ë„ê¶Œ' : 'ë¹„ìˆ˜ë„ê¶Œ';
            });
        }

        function handleReset() {
            document.getElementById('results').classList.add('hidden');
            currentResults = null;
            if (chart) {
                chart.destroy();
                chart = null;
            }
        }

        async function handleSubmit(e) {
            e.preventDefault();

            // ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘
            let middleAgedEmployees = parseInt(document.getElementById('middleAgedEmployees').value) || 0;
            let seniorEmployees = parseInt(document.getElementById('seniorEmployees').value) || 0;
            const trainedMiddleAged = parseInt(document.getElementById('trainedMiddleAged').value) || 0;

            // í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ì€ ì¤‘ì¥ë…„+ê³ ë ¹ìì˜ ë¶€ë¶„ì§‘í•©
            // í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ì´ ì¤‘ì¥ë…„+ê³ ë ¹ìë³´ë‹¤ í¬ë©´ ìë™ ì¡°ì •
            const totalOver50 = middleAgedEmployees + seniorEmployees;
            if (trainedMiddleAged > totalOver50) {
                // ë¶€ì¡±í•œ ì¸ì›ì„ ì¤‘ì¥ë…„(50~59ì„¸)ì— ì¶”ê°€
                middleAgedEmployees = middleAgedEmployees + (trainedMiddleAged - totalOver50);
            }

            const companyData = {
                companyName: document.getElementById('companyName').value || '',
                region: document.getElementById('region').value,
                regionType: document.getElementById('regionType').value,
                industry: document.getElementById('industry').value,
                totalEmployees: parseInt(document.getElementById('totalEmployees').value) || 0,
                youthEmployees: parseInt(document.getElementById('youthEmployees').value) || 0,
                middleAgedEmployees: middleAgedEmployees,
                seniorEmployees: seniorEmployees,
                disabledEmployees: parseInt(document.getElementById('disabledEmployees').value) || 0,
                severeDisabledEmployees: parseInt(document.getElementById('severeDisabledEmployees').value) || 0,
                childcareWorkers: parseInt(document.getElementById('childcareWorkers').value) || 0,
                nonRegularEmployees: parseInt(document.getElementById('nonRegularEmployees').value) || 0,
                trainedMiddleAged: trainedMiddleAged,
                hasRetirementAge: document.getElementById('hasRetirementAge').value === 'true'
            };

            const result = analyzeEligibility(companyData, subsidyData.subsidies);
            currentResults = { companyData, ...result };
            displayResults(currentResults);
        }

        function analyzeEligibility(company, subsidies) {
            const eligible = [];
            const notEligible = [];
            const calculations = [];

            for (const subsidy of subsidies) {
                const check = checkEligibility(company, subsidy);
                if (check.isEligible) {
                    const calc = calculateAmount(company, subsidy);
                    // ê¸ˆì•¡ì´ 0ì›ì¸ ê²½ìš° ìˆ˜ê¸‰ ë¶ˆê°€ë¡œ ë¶„ë¥˜
                    if (calc.totalAmount > 0) {
                        eligible.push({ subsidy, reasons: [] });
                        calculations.push(calc);
                    } else {
                        notEligible.push({ subsidy, reasons: ['í•´ë‹¹ ê·¼ë¡œì 0ëª…ìœ¼ë¡œ ì˜ˆìƒ ê¸ˆì•¡ 0ì›'] });
                    }
                } else {
                    notEligible.push({ subsidy, reasons: check.reasons });
                }
            }

            calculations.sort((a, b) => b.totalAmount - a.totalAmount);
            const optimal = findOptimalCombination(calculations, subsidies);

            return {
                eligibility: { eligible, notEligible },
                calculations,
                optimal,
                excludedByConflict: optimal.excluded || []
            };
        }

        function checkEligibility(company, subsidy) {
            const reasons = [];
            const elig = subsidy.eligibility;

            // ê¸°ë³¸ ê·œëª¨ ì¡°ê±´
            if (elig.minEmployees && company.totalEmployees < elig.minEmployees) {
                reasons.push(`ìµœì†Œ ${elig.minEmployees}ì¸ ì´ìƒ í•„ìš” (í˜„ì¬ ${company.totalEmployees}ì¸)`);
            }
            if (elig.maxEmployees && company.totalEmployees > elig.maxEmployees) {
                reasons.push(`${elig.maxEmployees}ì¸ ì´í•˜ ê¸°ì—…ë§Œ ê°€ëŠ¥ (í˜„ì¬ ${company.totalEmployees}ì¸)`);
            }

            // í•„ìˆ˜ ê·¼ë¡œì ìœ í˜• ì²´í¬
            if (elig.requiredEmployeeTypes && elig.requiredEmployeeTypes.length > 0) {
                for (const type of elig.requiredEmployeeTypes) {
                    if (type === 'ì²­ë…„' && !company.youthEmployees) reasons.push('ì²­ë…„ ê·¼ë¡œì(15~34ì„¸)ê°€ í•„ìš”í•©ë‹ˆë‹¤');
                    if (type === 'ê³ ë ¹ì' && !company.seniorEmployees) reasons.push('ê³ ë ¹ì ê·¼ë¡œì(60ì„¸+)ê°€ í•„ìš”í•©ë‹ˆë‹¤');
                    if (type === 'ì¥ì• ì¸' && !company.disabledEmployees && !company.severeDisabledEmployees) reasons.push('ì¥ì• ì¸ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
                    if (type === '50ì„¸ ì´ìƒ ì¤‘ì¥ë…„' && !company.middleAgedEmployees && !company.seniorEmployees) reasons.push('50ì„¸ ì´ìƒ ì¤‘ì¥ë…„ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
                }
            }

            // ì •ë…„ ê·œì • ì²´í¬
            if (elig.requiresRetirementAge && !company.hasRetirementAge) reasons.push('ì •ë…„ ê·œì •ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤');

            // ì¤‘ì¦ì¥ì• ì¸ ì²´í¬
            if (elig.requiresSevereDisabled && !company.severeDisabledEmployees) reasons.push('ì¤‘ì¦ì¥ì• ì¸ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');

            // ëŒ€ìƒ ì—…ì¢… ì²´í¬
            if (elig.targetIndustries && elig.targetIndustries.length > 0) {
                const isMatch = elig.targetIndustries.some(ind => company.industry.includes(ind) || ind.includes(company.industry));
                if (!isMatch) reasons.push(`ëŒ€ìƒ ì—…ì¢…: ${elig.targetIndustries.join(', ')}`);
            }

            // êµ¬ì§ì ëŒ€ìƒ ì§€ì›ê¸ˆ ì œì™¸
            if (elig.forJobSeekers) reasons.push('êµ¬ì§ì ëŒ€ìƒ ì§€ì›ê¸ˆ (ê¸°ì—… ëŒ€ìƒ ì•„ë‹˜)');

            // ì „ì œì¡°ê±´(í›ˆë ¨ ìˆ˜ë£Œ ë“±) ì²´í¬
            if (elig.prerequisite) {
                // ì¼ì†ë¶€ì¡±ì¼ìë¦¬ ë™í–‰ì¸ì„¼í‹°ë¸Œ: í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ì´ ìˆìœ¼ë©´ í†µê³¼
                if (subsidy.id === 'job-shortage-incentive-2026' && company.trainedMiddleAged > 0) {
                    // í›ˆë ¨ ìˆ˜ë£Œìê°€ ìˆìœ¼ë¯€ë¡œ ì „ì œì¡°ê±´ ì¶©ì¡±
                } else {
                    reasons.push(`ì „ì œì¡°ê±´ í•„ìš”: ${elig.prerequisite}`);
                }
            }

            // ===== ì§€ì›ê¸ˆë³„ ì¶”ê°€ ìê²©ìš”ê±´ ì²´í¬ =====

            // ì²­ë…„ì¼ìë¦¬ë„ì•½ì¥ë ¤ê¸ˆ: ì²­ë…„ í•„ìˆ˜
            if (subsidy.id === 'youth-job-leap-2026' && !company.youthEmployees) {
                if (!reasons.some(r => r.includes('ì²­ë…„'))) reasons.push('ì²­ë…„ ê·¼ë¡œì(15~34ì„¸)ê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }

            // ê³ ë ¹ìê³„ì†ê³ ìš©ì¥ë ¤ê¸ˆ: ê³ ë ¹ì í•„ìˆ˜
            if (subsidy.id === 'senior-continued-employment-2026' && !company.seniorEmployees) {
                if (!reasons.some(r => r.includes('ê³ ë ¹ì'))) reasons.push('ê³ ë ¹ì ê·¼ë¡œì(60ì„¸+)ê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }

            // ì¥ì• ì¸ê³ ìš©ì¥ë ¤ê¸ˆ: ì¥ì• ì¸ í•„ìˆ˜
            if (subsidy.id === 'disabled-employment-improvement-subsidy-2026') {
                if (!company.disabledEmployees && !company.severeDisabledEmployees) {
                    if (!reasons.some(r => r.includes('ì¥ì• ì¸'))) reasons.push('ì¥ì• ì¸ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
                }
            }

            // ì¤‘ì¦ì¥ì• ì¸ê³ ìš©ê°œì„ ì¥ë ¤ê¸ˆ: ì¤‘ì¦ì¥ì• ì¸ í•„ìˆ˜
            if (subsidy.id === 'severe-disabled-employment-improvement-2026' && !company.severeDisabledEmployees) {
                if (!reasons.some(r => r.includes('ì¤‘ì¦ì¥ì• ì¸'))) reasons.push('ì¤‘ì¦ì¥ì• ì¸ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }

            // ìœ¡ì•„ê¸° 10ì‹œ ì¶œê·¼ì œ, ì›Œë¼ë°¸ì¼ìë¦¬ ì¥ë ¤ê¸ˆ: ìœ¡ì•„ê¸° ê·¼ë¡œì í•„ìˆ˜
            if ((subsidy.id === 'parental-10am-work-2026' || subsidy.id === 'work-life-balance-incentive-2026') && !company.childcareWorkers) {
                reasons.push('ìœ¡ì•„ê¸° ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }

            // ì¶œì‚°ìœ¡ì•„ê¸° ê³ ìš©ì•ˆì •ì¥ë ¤ê¸ˆ: ìœ¡ì•„ê¸° ê·¼ë¡œì í•„ìˆ˜
            if (subsidy.id === 'maternity-employment-stability-2026' && !company.childcareWorkers) {
                reasons.push('ìœ¡ì•„íœ´ì§/ìœ¡ì•„ê¸° ê·¼ë¡œì‹œê°„ ë‹¨ì¶• ëŒ€ìƒ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }

            // ì •ê·œì§ ì „í™˜ ì§€ì›ê¸ˆ: ë¹„ì •ê·œì§ í•„ìˆ˜
            if (subsidy.id === 'regular-employment-conversion-2026' && !company.nonRegularEmployees) {
                reasons.push('ì •ê·œì§ ì „í™˜ ì˜ˆì • ë¹„ì •ê·œì§ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }

            // ì¼ì†ë¶€ì¡±ì¼ìë¦¬ ë™í–‰ì¸ì„¼í‹°ë¸Œ: í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„(50ì„¸+) í•„ìˆ˜
            if (subsidy.id === 'job-shortage-incentive-2026') {
                // í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ì´ ìˆìœ¼ë©´ 50ì„¸+ ìš”ê±´ ì¶©ì¡±
                const trainedMiddleAgedCount = company.trainedMiddleAged || 0;
                if (!trainedMiddleAgedCount) {
                    reasons.push('í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„(50ì„¸ ì´ìƒ) ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
                }
            }

            // ê³ ìš©ì´‰ì§„ì¥ë ¤ê¸ˆ: ì·¨ì—…ì·¨ì•½ê³„ì¸µ ê³ ìš© í•„ìš” (ì²­ë…„, ê³ ë ¹ì, ì¥ì• ì¸ ì¤‘ í•˜ë‚˜)
            if (subsidy.id === 'employment-promotion-incentive-2026') {
                const hasVulnerableWorker = company.youthEmployees || company.seniorEmployees ||
                    company.disabledEmployees || company.severeDisabledEmployees;
                if (!hasVulnerableWorker) {
                    reasons.push('ì·¨ì—…ì·¨ì•½ê³„ì¸µ(ì²­ë…„, ê³ ë ¹ì, ì¥ì• ì¸ ë“±) ê³ ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤');
                }
            }

            return { isEligible: reasons.length === 0, reasons };
        }

        function calculateAmount(company, subsidy) {
            let totalAmount = 0;
            let details = '';
            const calc = subsidy.calculation;

            switch (calc.type) {
                case 'regional-differentiated-2026':
                    const youthCount = company.youthEmployees || 0;
                    const companyAmount = calc.company.amount * youthCount;
                    let youthAmount = 0;
                    const regionType = company.regionType || 'ìˆ˜ë„ê¶Œ';
                    // ë¹„ìˆ˜ë„ê¶Œì€ "ë¹„ìˆ˜ë„ê¶Œì¼ë°˜"ìœ¼ë¡œ ë§¤í•‘ (ìš°ëŒ€/íŠ¹ë³„ì§€ì›ì§€ì—­ì€ ì¶”í›„ êµ¬ë¶„ ê°€ëŠ¥)
                    const youthRegionKey = regionType === 'ë¹„ìˆ˜ë„ê¶Œ' ? 'ë¹„ìˆ˜ë„ê¶Œì¼ë°˜' : regionType;
                    if (calc.youth[youthRegionKey]) {
                        youthAmount = calc.youth[youthRegionKey].totalAmount * youthCount;
                    }
                    totalAmount = companyAmount + youthAmount;
                    if (youthCount > 0) {
                        if (youthAmount > 0) {
                            details = `ê¸°ì—…ì§€ì› ${(calc.company.amount / 10000).toLocaleString()}ë§Œì› + ì²­ë…„ì§€ì› ${(youthAmount / youthCount / 10000).toLocaleString()}ë§Œì› Ã— ${youthCount}ëª…`;
                        } else {
                            details = `ê¸°ì—…ì§€ì› ${(calc.company.amount / 10000).toLocaleString()}ë§Œì› Ã— ${youthCount}ëª…`;
                        }
                    } else {
                        details = 'ì²­ë…„ ê·¼ë¡œì 0ëª…';
                    }
                    break;
                case 'regional-differentiated-quarterly':
                    const seniorCount = company.seniorEmployees || 0;
                    const isMetro = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ'].includes(company.region);
                    const regionCalc = isMetro ? calc['ìˆ˜ë„ê¶Œ'] : calc['ë¹„ìˆ˜ë„ê¶Œ'];
                    totalAmount = regionCalc.totalAmount * seniorCount;
                    details = seniorCount > 0
                        ? `${isMetro ? 'ìˆ˜ë„ê¶Œ' : 'ë¹„ìˆ˜ë„ê¶Œ'} ì›” ${(regionCalc.monthlyAmount / 10000)}ë§Œì› Ã— ${regionCalc.maxYears}ë…„ Ã— ${seniorCount}ëª…`
                        : 'ê³ ë ¹ì ê·¼ë¡œì 0ëª…';
                    break;
                case 'per-employee-monthly-by-gender':
                    // ì¤‘ì¦ì¥ì• ì¸ê³ ìš©ê°œì„ ì¥ë ¤ê¸ˆ - ë‚¨ë…€ í‰ê· ê°’ ì ìš©
                    const severeCountByGender = company.severeDisabledEmployees || 0;
                    const maleMonthly = calc['ì¤‘ì¦ë‚¨ì„±'].monthlyAmount;
                    const femaleMonthly = calc['ì¤‘ì¦ì—¬ì„±'].monthlyAmount;
                    const avgMonthlyByGender = (maleMonthly + femaleMonthly) / 2;
                    const maxMonthsByGender = calc['ì¤‘ì¦ë‚¨ì„±'].maxMonths || 12;
                    totalAmount = avgMonthlyByGender * maxMonthsByGender * severeCountByGender;
                    details = severeCountByGender > 0
                        ? `ì¤‘ì¦ì¥ì• ì¸ ${severeCountByGender}ëª… Ã— ì›” ${(avgMonthlyByGender / 10000)}ë§Œì›(ë‚¨ë…€í‰ê· ) Ã— ${maxMonthsByGender}ê°œì›”`
                        : 'ì¤‘ì¦ì¥ì• ì¸ ê·¼ë¡œì 0ëª…';
                    break;
                case 'per-employee-monthly':
                    // ì§€ì›ê¸ˆ ì¢…ë¥˜ì— ë”°ë¼ ì ìš© ëŒ€ìƒ ê²°ì •
                    let targetCount = 0;
                    let targetLabel = 'ê·¼ë¡œì';

                    if (subsidy.id === 'parental-10am-work-2026' || subsidy.id === 'work-life-balance-incentive-2026') {
                        targetCount = company.childcareWorkers || 0;
                        targetLabel = 'ìœ¡ì•„ê¸° ê·¼ë¡œì';
                    } else if (subsidy.id === 'flexible-work-incentive-2026') {
                        // ìœ ì—°ê·¼ë¬´ëŠ” ì „ì²´ ì§ì› ì¤‘ 30% í•œë„
                        targetCount = Math.min(Math.floor(company.totalEmployees * 0.3), 300);
                        targetLabel = 'ìœ ì—°ê·¼ë¬´ í™œìš©ì';
                    } else if (subsidy.id === 'work-life-balance-45-project-2026') {
                        // ì›Œë¼ë°¸ 4.5ëŠ” ìµœëŒ€ 50ëª…
                        targetCount = Math.min(company.totalEmployees, 50);
                        targetLabel = 'ì£¼4.5ì¼ ì ìš©ì';
                    } else {
                        targetCount = company.childcareWorkers || 0;
                        targetLabel = 'ëŒ€ìƒ ê·¼ë¡œì';
                    }

                    const monthlyAmt = calc.monthlyAmount || (calc.monthlyAmounts ? calc.monthlyAmounts['ì¬íƒì›ê²©ê·¼ë¬´'] : 300000);
                    const maxMonths = calc.maxMonths || 12;
                    totalAmount = monthlyAmt * maxMonths * targetCount;
                    details = targetCount > 0
                        ? `${targetLabel} ${targetCount}ëª… Ã— ì›” ${(monthlyAmt / 10000)}ë§Œì› Ã— ${maxMonths}ê°œì›”`
                        : `${targetLabel} 0ëª…`;
                    break;
                case 'one-time':
                    // ì¼Â·ê°€ì •ì–‘ë¦½ í™˜ê²½ê°œì„  ì‹œìŠ¤í…œêµ¬ì¶•ë¹„ ë“± 1íšŒì„± ì§€ì›
                    totalAmount = calc.maxAmount || 0;
                    details = calc.description || `ìµœëŒ€ ${(totalAmount / 10000).toLocaleString()}ë§Œì› (1íšŒ)`;
                    break;
                case 'milestone-based':
                    // ì¼ì†ë¶€ì¡±ì¼ìë¦¬ ë™í–‰ì¸ì„¼í‹°ë¸Œ: í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ ëŒ€ìƒ
                    // (handleSubmitì—ì„œ ì¤‘ì¥ë…„+ê³ ë ¹ì >= í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ìœ¼ë¡œ ì´ë¯¸ ì¡°ì •ë¨)
                    const trainedCount = company.trainedMiddleAged || 0;
                    totalAmount = calc.totalAmount * trainedCount;
                    details = trainedCount > 0
                        ? `í›ˆë ¨ìˆ˜ë£Œ 50ì„¸+ ì¤‘ì¥ë…„ ${trainedCount}ëª… Ã— ${(calc.totalAmount / 10000).toLocaleString()}ë§Œì›`
                        : 'í›ˆë ¨ìˆ˜ë£Œ ì¤‘ì¥ë…„ 0ëª…';
                    break;
                case 'company-size-differentiated':
                    // ê³ ìš©ì´‰ì§„ì¥ë ¤ê¸ˆ - ì·¨ì•½ê³„ì¸µ ì¸ì› ìˆ˜ ë°˜ì˜
                    const companyTypeCalc = calc['ìš°ì„ ì§€ì›ëŒ€ìƒê¸°ì—…'] || calc['ì¤‘ê²¬ê¸°ì—…'];
                    // ì·¨ì•½ê³„ì¸µ = ì²­ë…„ + ê³ ë ¹ì + ì¥ì• ì¸(ê²½ì¦+ì¤‘ì¦)
                    const vulnerableCount = (company.youthEmployees || 0) + (company.seniorEmployees || 0) +
                                            (company.disabledEmployees || 0) + (company.severeDisabledEmployees || 0);
                    totalAmount = companyTypeCalc.totalAmount * vulnerableCount;
                    details = vulnerableCount > 0
                        ? `ì·¨ì—…ì·¨ì•½ê³„ì¸µ ${vulnerableCount}ëª… Ã— ì—° ${(companyTypeCalc.totalAmount / 10000).toLocaleString()}ë§Œì›`
                        : 'ì·¨ì—…ì·¨ì•½ê³„ì¸µ ê·¼ë¡œì 0ëª…';
                    break;
                case 'multi-component':
                    // ì¶œì‚°ìœ¡ì•„ê¸° ê³ ìš©ì•ˆì •ì¥ë ¤ê¸ˆ - ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ ê¸°ë³¸ìœ¼ë¡œ ê³„ì‚°
                    // (ëŒ€ì²´ì¸ë ¥ì§€ì›ê¸ˆ, ì—…ë¬´ë¶„ë‹´ì§€ì›ê¸ˆì€ ë³„ë„ ì¸ë ¥ ì •ë³´ í•„ìš”)
                    if (calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ']) {
                        const childcareCount = company.childcareWorkers || 0;
                        const baseSupport = calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ']['ê¸°ë³¸'];
                        if (childcareCount > 0) {
                            if (baseSupport) {
                                totalAmount = baseSupport.totalAmount * childcareCount;
                                details = `ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ ${childcareCount}ëª… Ã— ì—° ${(baseSupport.totalAmount / 10000)}ë§Œì› (â€» ëŒ€ì²´ì¸ë ¥ ì±„ìš© ì‹œ ì¶”ê°€ 140ë§Œì›/ì›” ì§€ì› ê°€ëŠ¥)`;
                            } else {
                                totalAmount = (calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ'].monthlyAmount || 300000) * 12 * childcareCount;
                                details = `ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ ${childcareCount}ëª… Ã— ì›” ${((calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ'].monthlyAmount || 300000) / 10000)}ë§Œì› (â€» ëŒ€ì²´ì¸ë ¥ ì±„ìš© ì‹œ ì¶”ê°€ ì§€ì› ê°€ëŠ¥)`;
                            }
                        } else {
                            details = 'ìœ¡ì•„íœ´ì§/ìœ¡ì•„ê¸° ê·¼ë¡œì‹œê°„ ë‹¨ì¶• ëŒ€ìƒ ê·¼ë¡œì 0ëª…';
                        }
                    }
                    break;
                case 'per-employee-monthly-by-severity':
                    // ì¥ì• ì¸ê³ ìš©ì¥ë ¤ê¸ˆ - ì¥ì• ë“±ê¸‰/ì„±ë³„ë³„ ì°¨ë“±
                    const mildDisabledCount = company.disabledEmployees || 0;
                    const severeDisabledCount = company.severeDisabledEmployees || 0;
                    const totalDisabledCount = mildDisabledCount + severeDisabledCount;

                    // ê²½ì¦ í‰ê· : (40ë§Œ + 30ë§Œ) / 2 = 35ë§Œì›
                    // ì¤‘ì¦ í‰ê· : (60ë§Œ + 50ë§Œ) / 2 = 55ë§Œì›
                    const mildAvg = calc['ê²½ì¦ë‚¨ì„±'] && calc['ê²½ì¦ì—¬ì„±']
                        ? (calc['ê²½ì¦ë‚¨ì„±'].monthlyAmount + calc['ê²½ì¦ì—¬ì„±'].monthlyAmount) / 2
                        : 350000;
                    const severeAvg = calc['ì¤‘ì¦ë‚¨ì„±'] && calc['ì¤‘ì¦ì—¬ì„±']
                        ? (calc['ì¤‘ì¦ë‚¨ì„±'].monthlyAmount + calc['ì¤‘ì¦ì—¬ì„±'].monthlyAmount) / 2
                        : 550000;

                    const mildDisabledAmount = mildAvg * 12 * mildDisabledCount;
                    const severeDisabledAmount = severeAvg * 12 * severeDisabledCount;
                    totalAmount = mildDisabledAmount + severeDisabledAmount;

                    // ìƒì„¸ ë‚´ì—­ ì‘ì„±
                    if (mildDisabledCount > 0 && severeDisabledCount > 0) {
                        details = `ê²½ì¦ ${mildDisabledCount}ëª… Ã— ì›” ${(mildAvg / 10000)}ë§Œì› Ã— 12ê°œì›” + ì¤‘ì¦ ${severeDisabledCount}ëª… Ã— ì›” ${(severeAvg / 10000)}ë§Œì› Ã— 12ê°œì›”`;
                    } else if (severeDisabledCount > 0) {
                        details = `ì¤‘ì¦ì¥ì• ì¸ ${severeDisabledCount}ëª… Ã— ì›” ${(severeAvg / 10000)}ë§Œì› Ã— 12ê°œì›”`;
                    } else {
                        details = `ê²½ì¦ì¥ì• ì¸ ${mildDisabledCount}ëª… Ã— ì›” ${(mildAvg / 10000)}ë§Œì› Ã— 12ê°œì›”`;
                    }
                    break;
                case 'monthly-based-on-wage-increase':
                    // ì •ê·œì§ ì „í™˜ ì§€ì›ê¸ˆ - ë³´ìˆ˜ì ìœ¼ë¡œ ê¸°ë³¸ê¸ˆì•¡ ì ìš© (ì„ê¸ˆ ì¸ìƒ ì—¬ë¶€ ë¶ˆëª…)
                    const nonRegularCount = company.nonRegularEmployees || 0;
                    const baseConversionCalc = calc['ê·¸ì™¸']; // ê¸°ë³¸ 480ë§Œì› (ì„ê¸ˆì¸ìƒ 20ë§Œì› ë¯¸ë§Œ ê¸°ì¤€)
                    totalAmount = baseConversionCalc.totalAmount * nonRegularCount;
                    details = nonRegularCount > 0
                        ? `ë¹„ì •ê·œì§ ì „í™˜ ${nonRegularCount}ëª… Ã— ${(baseConversionCalc.totalAmount / 10000).toLocaleString()}ë§Œì› (ê¸°ë³¸, ì„ê¸ˆ 20ë§Œì›â†‘ ì¸ìƒ ì‹œ 720ë§Œì›)`
                        : 'ë¹„ì •ê·œì§ ê·¼ë¡œì 0ëª…';
                    break;
                case 'monthly-jobseeker-support':
                    // êµ¬ì§ì ì§€ì› (êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„, ì¥ì• ì¸ì·¨ì—…ì„±ê³µíŒ¨í‚¤ì§€ ë“±)
                    totalAmount = calc.totalAmount || 0;
                    details = calc.description || '';
                    break;
                default:
                    if (calc.totalAmount) {
                        totalAmount = calc.totalAmount;
                        details = calc.description || '';
                    } else if (calc.monthlyAmount) {
                        totalAmount = calc.monthlyAmount * (calc.maxMonths || 12);
                        details = calc.description || '';
                    }
            }

            return { subsidy, totalAmount, details };
        }

        function findOptimalCombination(calculations, allSubsidies) {
            if (calculations.length === 0) return { combination: [], totalAmount: 0, excluded: [] };

            // ê¸ˆì•¡ì´ í° ìˆœìœ¼ë¡œ ì •ë ¬
            const sorted = [...calculations].sort((a, b) => b.totalAmount - a.totalAmount);

            const combination = [];
            const excluded = []; // ì¤‘ë³µìœ¼ë¡œ ì œì™¸ëœ ì§€ì›ê¸ˆ
            let totalAmount = 0;
            const usedExclusions = new Set();
            const selectedIds = new Set();

            for (const calc of sorted) {
                const exclusions = calc.subsidy.mutuallyExclusive || [];

                // ì´ë¯¸ ì„ íƒëœ ì§€ì›ê¸ˆê³¼ ì¤‘ë³µ ì²´í¬
                const conflictWith = exclusions.find(ex => selectedIds.has(ex));

                if (conflictWith) {
                    // ì¤‘ë³µìœ¼ë¡œ ì œì™¸ë¨ - ì´ìœ  ê¸°ë¡
                    const conflictSubsidy = allSubsidies.find(s => s.id === conflictWith);
                    const selectedCalc = combination.find(c => c.subsidy.id === conflictWith);
                    excluded.push({
                        ...calc,
                        excludeReason: `'${conflictSubsidy?.name || conflictWith}'ê³¼(ì™€) ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€`,
                        betterOption: conflictSubsidy?.name,
                        betterAmount: selectedCalc?.totalAmount || 0,
                        amountDiff: (selectedCalc?.totalAmount || 0) - calc.totalAmount
                    });
                } else if (usedExclusions.has(calc.subsidy.id)) {
                    // ë‹¤ë¥¸ ì§€ì›ê¸ˆì— ì˜í•´ ì œì™¸ë¨
                    const blockedBy = combination.find(c =>
                        (c.subsidy.mutuallyExclusive || []).includes(calc.subsidy.id)
                    );
                    excluded.push({
                        ...calc,
                        excludeReason: `'${blockedBy?.subsidy.name}'ê³¼(ì™€) ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€`,
                        betterOption: blockedBy?.subsidy.name,
                        betterAmount: blockedBy?.totalAmount || 0,
                        amountDiff: (blockedBy?.totalAmount || 0) - calc.totalAmount
                    });
                } else {
                    // ì„ íƒ ê°€ëŠ¥
                    combination.push(calc);
                    totalAmount += calc.totalAmount;
                    selectedIds.add(calc.subsidy.id);
                    exclusions.forEach(ex => usedExclusions.add(ex));
                }
            }

            return { combination, totalAmount, excluded };
        }

        function getVerificationBadge(status) {
            if (status === 'confirmed2026') {
                return '<span class="verification-badge badge-confirmed">âœ… 2026ë…„ í™•ì¸</span>';
            } else if (status === 'pending2026') {
                return '<span class="verification-badge badge-pending">âš ï¸ 2025ë…„ ê¸°ì¤€</span>';
            }
            return '';
        }

        function displayResults(results) {
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('totalAmount').textContent = results.optimal.totalAmount.toLocaleString() + 'ì›';
            document.getElementById('eligibleCount').textContent = results.optimal.combination.length;

            // ìˆ˜ê¸‰ ê°€ëŠ¥ ëª©ë¡
            const eligibleList = document.getElementById('eligibleList');
            eligibleList.innerHTML = results.optimal.combination.map(item => `
                <li class="subsidy-item eligible">
                    <h4>
                        ${item.subsidy.name}
                        ${getVerificationBadge(item.subsidy.verificationStatus)}
                    </h4>
                    <p><strong>ê¸ˆì•¡:</strong> ${item.totalAmount.toLocaleString()}ì›</p>
                    <p><strong>ì‚°ì¶œ:</strong> ${item.details}</p>
                    ${item.subsidy.verificationSource ? `<p class="verification-source">ğŸ“‹ ${item.subsidy.verificationSource}</p>` : ''}
                </li>
            `).join('');

            // ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ë¡œ ì œì™¸ëœ ì§€ì›ê¸ˆ (ë” ì¢‹ì€ ëŒ€ì•ˆ ì„ íƒë¨)
            const excludedByConflict = results.excludedByConflict || [];
            if (excludedByConflict.length > 0) {
                const excludedHtml = excludedByConflict.map(item => `
                    <li class="subsidy-item excluded-conflict" style="background: #fff3e0; border-left: 4px solid #ff9800;">
                        <h4>
                            ${item.subsidy.name}
                            <span style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">ì¤‘ë³µ ì œì™¸</span>
                        </h4>
                        <p><strong>ì˜ˆìƒ ê¸ˆì•¡:</strong> ${item.totalAmount.toLocaleString()}ì›</p>
                        <p style="color: #e65100;"><strong>âš ï¸ ì œì™¸ ì‚¬ìœ :</strong> ${item.excludeReason}</p>
                        <p style="color: #2e7d32;"><strong>âœ… ë” ìœ ë¦¬í•œ ì„ íƒ:</strong> '${item.betterOption}' (${item.betterAmount.toLocaleString()}ì›) - <strong>${item.amountDiff >= 0 ? '+' : ''}${item.amountDiff.toLocaleString()}ì› ë” ë§ìŒ</strong></p>
                    </li>
                `).join('');

                eligibleList.innerHTML += `
                    <li style="background: #fff8e1; padding: 15px; margin-top: 20px; border-radius: 8px; list-style: none;">
                        <h4 style="color: #f57c00; margin: 0 0 10px 0;">ğŸ”„ ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ (ë” ìœ ë¦¬í•œ ëŒ€ì•ˆ ì„ íƒë¨)</h4>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${excludedHtml}
                        </ul>
                    </li>
                `;
            }

            // ìˆ˜ê¸‰ ë¶ˆê°€ ëª©ë¡
            const notEligibleList = document.getElementById('notEligibleList');
            notEligibleList.innerHTML = results.eligibility.notEligible.map(item => `
                <li class="subsidy-item not-eligible">
                    <h4>
                        ${item.subsidy.name}
                        ${getVerificationBadge(item.subsidy.verificationStatus)}
                    </h4>
                    <p><strong>ë¯¸ì¶©ì¡± ì‚¬ìœ :</strong> ${item.reasons.join(', ')}</p>
                </li>
            `).join('');

            // ì°¨íŠ¸
            renderChart(results.calculations);
        }

        function renderChart(calculations) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            if (chart) chart.destroy();

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: calculations.slice(0, 6).map(c => c.subsidy.name.substring(0, 10) + '...'),
                    datasets: [{
                        label: 'ì˜ˆìƒ ì§€ì›ê¸ˆ (ì›)',
                        data: calculations.slice(0, 6).map(c => c.totalAmount),
                        backgroundColor: ['#C8A97E', '#A8875E', '#3D3D3D', '#5D5D5D', '#D4B896', '#4D4D4D']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: v => (v / 10000).toLocaleString() + 'ë§Œì›' }
                        }
                    }
                }
            });
        }

        function exportExcel() {
            if (!currentResults) return;

            const wb = XLSX.utils.book_new();

            // ê¸°ì—… ì •ë³´
            const companySheet = [
                ['2026ë…„ ê³ ìš©ì§€ì›ê¸ˆ ë¶„ì„ ê²°ê³¼'],
                [],
                ['ê¸°ì—… ì •ë³´'],
                ['ì§€ì—­', currentResults.companyData.region],
                ['ì§€ì—­ìœ í˜•', currentResults.companyData.regionType],
                ['ì—…ì¢…', currentResults.companyData.industry],
                ['ì´ ì§ì›ìˆ˜', currentResults.companyData.totalEmployees],
                ['ì²­ë…„(15~34ì„¸)', currentResults.companyData.youthEmployees],
                ['ì¤‘ì¥ë…„(50~59ì„¸)', currentResults.companyData.middleAgedEmployees],
                ['ê³ ë ¹ì(60ì„¸+)', currentResults.companyData.seniorEmployees],
                ['ì¥ì• ì¸', currentResults.companyData.disabledEmployees],
                ['ì¤‘ì¦ì¥ì• ì¸', currentResults.companyData.severeDisabledEmployees],
                ['ìœ¡ì•„ê¸° ê·¼ë¡œì', currentResults.companyData.childcareWorkers],
                ['ë¹„ì •ê·œì§', currentResults.companyData.nonRegularEmployees],
            ];
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(companySheet), 'ê¸°ì—…ì •ë³´');

            // ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ (ìƒì„¸ ì •ë³´ í¬í•¨)
            const eligibleSheet = [
                ['ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ ìƒì„¸'],
                [],
                ['ì§€ì›ê¸ˆëª…', 'ì˜ˆìƒ ê¸ˆì•¡', 'ì‚°ì¶œ ë‚´ì—­', 'í•„ìš”ì„œë¥˜', 'ì‹ ì²­ë°©ë²•', 'ë¬¸ì˜ì²˜']
            ];
            currentResults.optimal.combination.forEach(item => {
                const docs = item.subsidy.requiredDocuments ? item.subsidy.requiredDocuments.join(' / ') : '-';
                const method = item.subsidy.applicationMethod || '-';
                const contact = item.subsidy.contact || '-';
                eligibleSheet.push([item.subsidy.name, item.totalAmount, item.details, docs, method, contact]);
            });
            eligibleSheet.push([], ['ì´ ì˜ˆìƒ ìˆ˜ê¸‰ì•¡', currentResults.optimal.totalAmount, '', '', '', '']);
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(eligibleSheet), 'ìˆ˜ê¸‰ê°€ëŠ¥ì§€ì›ê¸ˆ');

            // ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ë¡œ ì œì™¸ëœ ì§€ì›ê¸ˆ
            const excludedByConflict = currentResults.excludedByConflict || [];
            if (excludedByConflict.length > 0) {
                const conflictSheet = [
                    ['ğŸ”„ ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ (ë” ìœ ë¦¬í•œ ëŒ€ì•ˆ ì„ íƒë¨)'],
                    [],
                    ['ì§€ì›ê¸ˆëª…', 'ì˜ˆìƒ ê¸ˆì•¡', 'ì œì™¸ ì‚¬ìœ ', 'ë” ìœ ë¦¬í•œ ì„ íƒ', 'ê¸ˆì•¡ ì°¨ì´'],
                ];
                excludedByConflict.forEach(item => {
                    conflictSheet.push([
                        item.subsidy.name,
                        item.totalAmount,
                        item.excludeReason,
                        `${item.betterOption} (${item.betterAmount.toLocaleString()}ì›)`,
                        `+${item.amountDiff.toLocaleString()}ì› ë” ë§ìŒ`
                    ]);
                });
                conflictSheet.push([]);
                conflictSheet.push(['ğŸ’¡ ì•ˆë‚´: ìœ„ ì§€ì›ê¸ˆë“¤ì€ ë‹¤ë¥¸ ì§€ì›ê¸ˆê³¼ ë™ì‹œ ìˆ˜ê¸‰ì´ ë¶ˆê°€í•˜ì—¬, ê¸ˆì•¡ì´ ë” í° ì§€ì›ê¸ˆì„ ì¶”ì²œë“œë ¸ìŠµë‹ˆë‹¤.']);
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(conflictSheet), 'ì¤‘ë³µì œì™¸ì§€ì›ê¸ˆ');
            }

            // ì‹ ì²­ ì ˆì°¨ ì•ˆë‚´
            const procedureSheet = [
                ['ğŸ“‹ ì‹ ì²­ ì ˆì°¨ ì•ˆë‚´'],
                [],
                ['ë‹¨ê³„', 'ë‚´ìš©', 'ë¹„ê³ '],
                ['1ë‹¨ê³„', 'ìê²© ìš”ê±´ í™•ì¸', 'ë³¸ ë¶„ì„ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•´ë‹¹ ì§€ì›ê¸ˆ ìˆ˜ê¸‰ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸'],
                ['2ë‹¨ê³„', 'í•„ìš” ì„œë¥˜ ì¤€ë¹„', 'ê° ì§€ì›ê¸ˆë³„ í•„ìš”ì„œë¥˜ ì‚¬ì „ ì¤€ë¹„ (ì•„ë˜ ëª©ë¡ ì°¸ì¡°)'],
                ['3ë‹¨ê³„', 'ì˜¨ë¼ì¸/ë°©ë¬¸ ì‹ ì²­', 'ê³ ìš©24(www.work24.go.kr) ë˜ëŠ” ê´€í•  ê³ ìš©ì„¼í„° ë°©ë¬¸'],
                ['4ë‹¨ê³„', 'ì‹¬ì‚¬ ë° ìŠ¹ì¸', 'ì œì¶œ ì„œë¥˜ ì‹¬ì‚¬ (í†µìƒ 2~4ì£¼ ì†Œìš”)'],
                ['5ë‹¨ê³„', 'ì§€ì›ê¸ˆ ì§€ê¸‰', 'ìŠ¹ì¸ í›„ ì§€ì • ê³„ì¢Œë¡œ ì§€ê¸‰'],
                [],
                ['ğŸ“ ì£¼ìš” ë¬¸ì˜ì²˜'],
                ['ê³ ìš©ë…¸ë™ë¶€ ì½œì„¼í„°', '1350'],
                ['í•œêµ­ì¥ì• ì¸ê³ ìš©ê³µë‹¨', '1588-1519'],
                ['ê³ ìš©24 í™ˆí˜ì´ì§€', 'www.work24.go.kr'],
                [],
                ['âš ï¸ ê³µí†µ ìœ ì˜ì‚¬í•­'],
                ['1. ì›”í‰ê·  ë³´ìˆ˜ 124ë§Œì› ë¯¸ë§Œ ê·¼ë¡œìëŠ” ëŒ€ë¶€ë¶„ì˜ ì§€ì›ê¸ˆì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.'],
                ['2. ì‚¬ì—…ì£¼ì˜ ë°°ìš°ì, ì§ê³„ ì¡´ë¹„ì†ì€ ì§€ì› ëŒ€ìƒì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.'],
                ['3. ì™¸êµ­ì¸ ê·¼ë¡œìëŠ” F-2, F-5, F-6 ë¹„ì ì†Œì§€ìë§Œ ì§€ì› ê°€ëŠ¥í•©ë‹ˆë‹¤.'],
                ['4. ê³ ìš©ë³´í—˜ ê°€ì…ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.'],
                ['5. ë³¸ ë¶„ì„ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ìˆ˜ê¸‰ ì—¬ë¶€ëŠ” ê³ ìš©ì„¼í„° ì‹¬ì‚¬ë¥¼ í†µí•´ ê²°ì •ë©ë‹ˆë‹¤.'],
            ];
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(procedureSheet), 'ì‹ ì²­ì ˆì°¨ì•ˆë‚´');

            // ì§€ì›ê¸ˆë³„ ìƒì„¸ í•„ìš”ì„œë¥˜
            const docsSheet = [
                ['ğŸ“„ ì§€ì›ê¸ˆë³„ í•„ìš”ì„œë¥˜ ìƒì„¸'],
                [],
            ];
            currentResults.optimal.combination.forEach((item, idx) => {
                docsSheet.push([`${idx + 1}. ${item.subsidy.name}`]);
                docsSheet.push(['   ì‹ ì²­ë°©ë²•:', item.subsidy.applicationMethod || '-']);
                docsSheet.push(['   ë¬¸ì˜ì²˜:', item.subsidy.contact || '-']);
                docsSheet.push(['   í•„ìš”ì„œë¥˜:']);
                if (item.subsidy.requiredDocuments && item.subsidy.requiredDocuments.length > 0) {
                    item.subsidy.requiredDocuments.forEach((doc, docIdx) => {
                        docsSheet.push([`     ${docIdx + 1}. ${doc}`]);
                    });
                }
                if (item.subsidy.notes) {
                    docsSheet.push(['   ì°¸ê³ ì‚¬í•­:', item.subsidy.notes]);
                }
                docsSheet.push([]);
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(docsSheet), 'í•„ìš”ì„œë¥˜ìƒì„¸');

            // ìˆ˜ê¸‰ ë¶ˆê°€
            const notEligibleSheet = [
                ['ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ'],
                [],
                ['ì§€ì›ê¸ˆëª…', 'ë¯¸ì¶©ì¡± ì‚¬ìœ ']
            ];
            currentResults.eligibility.notEligible.forEach(item => {
                notEligibleSheet.push([item.subsidy.name, item.reasons.join(', ')]);
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(notEligibleSheet), 'ìˆ˜ê¸‰ë¶ˆê°€ì§€ì›ê¸ˆ');

            XLSX.writeFile(wb, 'ê³ ìš©ì§€ì›ê¸ˆ_ë¶„ì„ê²°ê³¼.xlsx');
        }

        async function exportPdf() {
            if (!currentResults) return;

            const btn = document.getElementById('exportPdf');
            const originalText = btn.textContent;
            btn.textContent = 'â³ PDF ìƒì„± ì¤‘...';
            btn.disabled = true;

            try {
                const companyName = currentResults.companyData.companyName || 'ê·€ì‚¬';
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');

                const PAGE_WIDTH = 794;  // A4 width in px at 96dpi
                const PAGE_HEIGHT = 1123; // A4 height in px at 96dpi
                const CONTENT_HEIGHT = 1000; // ì‹¤ì œ ì½˜í…ì¸  ì˜ì—­ (í—¤ë”/í‘¸í„° ì œì™¸)

                // ê³µí†µ ìŠ¤íƒ€ì¼
                const baseStyle = `
                    width: ${PAGE_WIDTH}px;
                    height: ${PAGE_HEIGHT}px;
                    background: white;
                    font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
                    color: #333;
                    line-height: 1.5;
                    box-sizing: border-box;
                    overflow: hidden;
                `;

                // í—¤ë” ìƒì„± í•¨ìˆ˜ - ê³ ê¸‰ ìŠ¤íƒ€ì¼
                const createHeader = (title) => `
                    <div style="background: linear-gradient(135deg, #3D3D3D 0%, #2D2D2D 100%); color: white; padding: 22px 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                        <span style="font-size: 20px; font-weight: 700; color: #C8A97E; letter-spacing: 1px;">${title}</span>
                        <span style="font-size: 13px; color: #aaa; font-weight: 500;">${companyName}</span>
                    </div>
                `;

                // í‘¸í„° ìƒì„± í•¨ìˆ˜ - ê³ ê¸‰ ìŠ¤íƒ€ì¼
                const createFooter = (pageNum, totalPages) => `
                    <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 18px 50px; text-align: center; color: #aaa; font-size: 11px; border-top: 1px solid #eee; background: #fafafa;">
                        <span style="color: #C8A97E; font-weight: 600;">ë…¸ë¬´ë²•ì¸ ê°™ì´</span> | ${pageNum} / ${totalPages}
                    </div>
                `;

                // í˜ì´ì§€ ë Œë”ë§ í•¨ìˆ˜
                async function renderPage(html) {
                    const container = document.createElement('div');
                    container.style.cssText = 'position: fixed; top: 0; left: -9999px;';
                    container.innerHTML = html;
                    document.body.appendChild(container);

                    const canvas = await html2canvas(container, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff',
                        width: PAGE_WIDTH,
                        height: PAGE_HEIGHT
                    });

                    document.body.removeChild(container);
                    return canvas.toDataURL('image/jpeg', 0.95);
                }

                // ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆì„ í˜ì´ì§€ë³„ë¡œ ë¶„ë°°
                const eligibleItems = currentResults.optimal.combination;
                const excludedItems = currentResults.excludedByConflict || [];
                const notEligibleItems = currentResults.eligibility.notEligible;

                // í˜ì´ì§€ êµ¬ì„± ê³„ì‚° - ìŠ¤ë§ˆíŠ¸ ë°°ì¹˜
                const pages = [];

                // 1. ì»¤ë²„ í˜ì´ì§€
                pages.push({
                    type: 'cover',
                    title: 'í‘œì§€'
                });

                // 2. ì½˜í…ì¸  í˜ì´ì§€ - ìŠ¤ë§ˆíŠ¸ ë°°ì¹˜
                // ìˆ˜ê¸‰ ê°€ëŠ¥ì´ 3ê°œ ì´í•˜ë©´ ìˆ˜ê¸‰ ë¶ˆê°€ì™€ í•©ì¹¨
                const ELIGIBLE_PER_PAGE = 2;  // í•„ìš”ì„œë¥˜ ì „ì²´ í‘œì‹œë¡œ í•­ëª© ìˆ˜ ì¶”ê°€ ì¶•ì†Œ
                const NOT_ELIGIBLE_PER_PAGE = 10;

                if (eligibleItems.length <= 3 && eligibleItems.length > 0) {
                    // ìˆ˜ê¸‰ ê°€ëŠ¥ + ìˆ˜ê¸‰ ë¶ˆê°€ë¥¼ í•œ í˜ì´ì§€ì— (ì½¤ë³´ í˜ì´ì§€)
                    // ìˆ˜ê¸‰ ê°€ëŠ¥ ê°œìˆ˜ì— ë”°ë¼ ìˆ˜ê¸‰ ë¶ˆê°€ ê°œìˆ˜ ì¡°ì • (A4 ì„¸ë¡œ ìµœì í™”)
                    const maxNotEligibleInCombo = eligibleItems.length <= 2 ? 12 : 10;
                    const comboNotEligibleCount = Math.min(notEligibleItems.length, maxNotEligibleInCombo);
                    pages.push({
                        type: 'combo',
                        eligibleItems: eligibleItems,
                        excludedItems: excludedItems,
                        notEligibleItems: notEligibleItems.slice(0, comboNotEligibleCount),
                        remainingNotEligible: notEligibleItems.slice(comboNotEligibleCount)
                    });

                    // ë‚˜ë¨¸ì§€ ìˆ˜ê¸‰ ë¶ˆê°€ í•­ëª©ì´ ìˆìœ¼ë©´ ë³„ë„ í˜ì´ì§€
                    const remaining = notEligibleItems.slice(comboNotEligibleCount);
                    if (remaining.length > 0) {
                        for (let i = 0; i < remaining.length; i += NOT_ELIGIBLE_PER_PAGE) {
                            pages.push({
                                type: 'notEligible',
                                items: remaining.slice(i, i + NOT_ELIGIBLE_PER_PAGE),
                                excludedItems: [],
                                isFirst: false
                            });
                        }
                    }
                } else {
                    // ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ í˜ì´ì§€ë“¤
                    for (let i = 0; i < eligibleItems.length; i += ELIGIBLE_PER_PAGE) {
                        pages.push({
                            type: 'eligible',
                            items: eligibleItems.slice(i, i + ELIGIBLE_PER_PAGE),
                            startIdx: i,
                            isFirst: i === 0
                        });
                    }

                    // ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ í˜ì´ì§€
                    if (excludedItems.length > 0 || notEligibleItems.length > 0) {
                        for (let i = 0; i < notEligibleItems.length; i += NOT_ELIGIBLE_PER_PAGE) {
                            pages.push({
                                type: 'notEligible',
                                items: notEligibleItems.slice(i, i + NOT_ELIGIBLE_PER_PAGE),
                                excludedItems: i === 0 ? excludedItems : [],
                                isFirst: i === 0
                            });
                        }
                        if (notEligibleItems.length === 0 && excludedItems.length > 0) {
                            pages.push({
                                type: 'notEligible',
                                items: [],
                                excludedItems: excludedItems,
                                isFirst: true
                            });
                        }
                    }
                }

                // 3. ì‹ ì²­ ì•ˆë‚´ í˜ì´ì§€
                pages.push({
                    type: 'guide',
                    title: 'ì‹ ì²­ ì•ˆë‚´'
                });

                const totalPages = pages.length;

                // ê° í˜ì´ì§€ ë Œë”ë§
                for (let i = 0; i < pages.length; i++) {
                    const page = pages[i];
                    let pageHtml = '';

                    if (page.type === 'cover') {
                        // ì»¤ë²„ í˜ì´ì§€ - ê³ ê¸‰ ë³´ê³ ì„œ ìŠ¤íƒ€ì¼
                        pageHtml = `
                            <div style="${baseStyle} display: flex; flex-direction: column;">
                                <!-- ìƒë‹¨ ì—¬ë°± -->
                                <div style="height: 60px;"></div>

                                <!-- í—¤ë” -->
                                <div style="background: linear-gradient(135deg, #3D3D3D 0%, #2D2D2D 100%); padding: 60px 50px; text-align: center; border-bottom: 5px solid #C8A97E; margin: 0 40px; border-radius: 12px 12px 0 0;">
                                    <div style="font-size: 14px; color: #C8A97E; margin-bottom: 20px; letter-spacing: 4px; text-transform: uppercase;">${companyName}</div>
                                    <div style="font-size: 38px; font-weight: 800; color: white; margin-bottom: 12px; letter-spacing: 2px;">2026ë…„ ê³ ìš©ì§€ì›ê¸ˆ</div>
                                    <div style="font-size: 32px; font-weight: 700; color: white; margin-bottom: 20px;">ë¶„ì„ ë³´ê³ ì„œ</div>
                                    <div style="font-size: 12px; color: #888; letter-spacing: 3px;">Employment Subsidy Analysis Report</div>
                                </div>

                                <!-- ë©”ì¸ ì½˜í…ì¸  -->
                                <div style="flex: 1; padding: 50px 50px 30px 50px; display: flex; flex-direction: column; justify-content: center;">
                                    <!-- ì´ ì˜ˆìƒ ê¸ˆì•¡ - ì¤‘ì•™ ê°•ì¡° -->
                                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%); padding: 40px 50px; border-radius: 16px; border-left: 6px solid #C8A97E; margin-bottom: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                                        <div style="font-size: 14px; color: #888; margin-bottom: 12px; letter-spacing: 1px;">ì´ ì˜ˆìƒ ìˆ˜ê¸‰ì•¡</div>
                                        <div style="font-size: 48px; font-weight: 800; color: #3D3D3D; letter-spacing: -1px;">${currentResults.optimal.totalAmount.toLocaleString()}ì›</div>
                                        <div style="font-size: 15px; color: #C8A97E; margin-top: 12px; font-weight: 600;">ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ ${currentResults.optimal.combination.length}ê°œ</div>
                                    </div>

                                    <!-- ê¸°ì—… ì •ë³´ -->
                                    <div style="background: #fff; padding: 30px 40px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.05);">
                                        <div style="font-size: 18px; font-weight: 700; color: #3D3D3D; margin-bottom: 25px; padding-bottom: 12px; border-bottom: 3px solid #C8A97E; display: inline-block;">ê¸°ì—… í˜„í™© ìš”ì•½</div>
                                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                            <tr><td style="padding: 14px 0; color: #666; width: 180px;">ì§€ì—­</td><td style="padding: 14px 0; font-weight: 600; color: #333;">${currentResults.companyData.region} (${currentResults.companyData.regionType})</td></tr>
                                            <tr style="background: #fafafa;"><td style="padding: 14px 0; color: #666;">ì—…ì¢…</td><td style="padding: 14px 0; font-weight: 600; color: #333;">${currentResults.companyData.industry}</td></tr>
                                            <tr><td style="padding: 14px 0; color: #666;">ì´ ì§ì›ìˆ˜</td><td style="padding: 14px 0; font-weight: 600; color: #333;">${currentResults.companyData.totalEmployees}ëª…</td></tr>
                                            <tr style="background: #fafafa;"><td style="padding: 14px 0; color: #666;">ì²­ë…„ (15~34ì„¸)</td><td style="padding: 14px 0; font-weight: 600; color: #333;">${currentResults.companyData.youthEmployees}ëª…</td></tr>
                                            <tr><td style="padding: 14px 0; color: #666;">ê³ ë ¹ì (60ì„¸+)</td><td style="padding: 14px 0; font-weight: 600; color: #333;">${currentResults.companyData.seniorEmployees}ëª…</td></tr>
                                            <tr style="background: #fafafa;"><td style="padding: 14px 0; color: #666;">ì¥ì• ì¸</td><td style="padding: 14px 0; font-weight: 600; color: #333;">${currentResults.companyData.disabledEmployees}ëª… (ì¤‘ì¦: ${currentResults.companyData.severeDisabledEmployees}ëª…)</td></tr>
                                            <tr><td style="padding: 14px 0; color: #666;">ìœ¡ì•„ê¸° ê·¼ë¡œì</td><td style="padding: 14px 0; font-weight: 600; color: #333;">${currentResults.companyData.childcareWorkers}ëª…</td></tr>
                                        </table>
                                    </div>
                                </div>

                                <!-- í‘¸í„° -->
                                <div style="padding: 20px 50px; text-align: center; color: #aaa; font-size: 11px; border-top: 1px solid #eee; background: #fafafa;">
                                    <span style="color: #C8A97E; font-weight: 600;">ë…¸ë¬´ë²•ì¸ ê°™ì´</span> | ìƒì„±ì¼ì‹œ: ${new Date().toLocaleDateString('ko-KR')} | ${i + 1} / ${totalPages}
                                </div>
                            </div>
                        `;
                    } else if (page.type === 'combo') {
                        // ì½¤ë³´ í˜ì´ì§€: ìˆ˜ê¸‰ ê°€ëŠ¥ + ìˆ˜ê¸‰ ë¶ˆê°€ë¥¼ í•¨ê»˜ í‘œì‹œ - ìƒì„¸ ì •ë³´ í¬í•¨
                        const eligibleHtml = page.eligibleItems.map((item, idx) => {
                            const docs = item.subsidy.requiredDocuments || [];
                            const docsHtml = docs.length > 0
                                ? docs.map((doc, i) => `<div style="margin-left: 70px; color: #555; font-size: 10px;">${i + 1}. ${doc}</div>`).join('')
                                : '<div style="margin-left: 70px; color: #555; font-size: 10px;">ê³ ìš©ì„¼í„° ë¬¸ì˜</div>';
                            return `
                            <div style="background: linear-gradient(135deg, #f0fdf4 0%, #fff 100%); padding: 16px 18px; margin: 8px 0; border-radius: 10px; border-left: 5px solid #22c55e; box-shadow: 0 2px 8px rgba(34,197,94,0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px;">
                                    <div style="font-size: 14px; font-weight: 700; color: #166534;">${idx + 1}. ${item.subsidy.name}</div>
                                    <div style="font-size: 16px; font-weight: 800; color: #C8A97E;">${item.totalAmount.toLocaleString()}ì›</div>
                                </div>
                                <div style="font-size: 11px; color: #555; margin-bottom: 10px;">${item.details}</div>
                                <div style="background: #f8faf8; padding: 10px 12px; border-radius: 6px; font-size: 10px; line-height: 1.5;">
                                    <div style="display: flex; margin-bottom: 4px;">
                                        <span style="color: #166534; font-weight: 600; min-width: 60px;">ğŸ“ ì‹ ì²­ì²˜</span>
                                        <span style="color: #333;">${item.subsidy.applicationMethod || 'ê³ ìš©24'}</span>
                                    </div>
                                    <div style="display: flex; margin-bottom: 4px;">
                                        <span style="color: #166534; font-weight: 600; min-width: 60px;">ğŸ“ ë¬¸ì˜ì²˜</span>
                                        <span style="color: #333;">${item.subsidy.contact || 'ê³ ìš©ë…¸ë™ë¶€ 1350'}</span>
                                    </div>
                                    <div style="margin-bottom: 2px;">
                                        <span style="color: #166534; font-weight: 600;">ğŸ“‹ í•„ìš”ì„œë¥˜</span>
                                    </div>
                                    ${docsHtml}
                                </div>
                            </div>
                        `}).join('');

                        const excludedHtml = page.excludedItems.length > 0 ? `
                            <div style="margin-top: 30px; margin-bottom: 15px;">
                                <div style="font-size: 14px; font-weight: 700; color: #ea580c; margin-bottom: 12px; padding: 8px 14px; background: linear-gradient(135deg, #fff7ed 0%, #fff 100%); border-radius: 8px; display: inline-block; box-shadow: 0 2px 6px rgba(249,115,22,0.1);">
                                    âš ï¸ ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€
                                </div>
                                ${page.excludedItems.map(item => `
                                    <div style="background: #fff7ed; padding: 12px 16px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #f97316;">
                                        <span style="font-weight: 600; color: #c2410c; font-size: 13px;">${item.subsidy.name}</span>
                                        <span style="color: #166534; margin-left: 12px; font-size: 12px;">â†’ ${item.betterOption}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '';

                        const notEligibleHtml = page.notEligibleItems.length > 0 ? `
                            <div style="margin-top: 30px;">
                                <div style="font-size: 14px; font-weight: 700; color: #b91c1c; margin-bottom: 12px;">ìê²© ìš”ê±´ ë¯¸ì¶©ì¡± (${notEligibleItems.length}ê°œ)</div>
                                ${page.notEligibleItems.map(item => `
                                    <div style="background: #fef2f2; padding: 12px 16px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #ef4444;">
                                        <div style="font-size: 13px; font-weight: 600; color: #b91c1c; margin-bottom: 4px;">${item.subsidy.name}</div>
                                        <div style="font-size: 11px; color: #666;">ë¯¸ì¶©ì¡±: ${item.reasons.join(', ')}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '';

                        pageHtml = `
                            <div style="${baseStyle} display: flex; flex-direction: column;">
                                ${createHeader('ì§€ì›ê¸ˆ ë¶„ì„ ê²°ê³¼')}
                                <div style="flex: 1; padding: 40px 50px; display: flex; flex-direction: column; justify-content: center;">
                                    <div style="font-size: 16px; font-weight: 700; color: #166534; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 3px solid #22c55e; display: inline-block;">
                                        âœ… ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ (${page.eligibleItems.length}ê°œ)
                                    </div>
                                    ${eligibleHtml}
                                    ${excludedHtml}
                                    ${notEligibleHtml}
                                </div>
                                ${createFooter(i + 1, totalPages)}
                            </div>
                        `;
                    } else if (page.type === 'eligible') {
                        // ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ í˜ì´ì§€ - ìƒì„¸ ì •ë³´ í¬í•¨
                        const itemsHtml = page.items.map((item, idx) => {
                            const docs = item.subsidy.requiredDocuments || [];
                            const docsHtml = docs.length > 0
                                ? docs.map((doc, i) => `<div style="margin-left: 70px; color: #555;">${i + 1}. ${doc}</div>`).join('')
                                : '<div style="margin-left: 70px; color: #555;">ê³ ìš©ì„¼í„° ë¬¸ì˜</div>';
                            return `
                            <div style="background: linear-gradient(135deg, #f0fdf4 0%, #fff 100%); padding: 20px 24px; margin: 14px 0; border-radius: 12px; border-left: 5px solid #22c55e; box-shadow: 0 2px 10px rgba(34,197,94,0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <div style="font-size: 16px; font-weight: 700; color: #166534;">${page.startIdx + idx + 1}. ${item.subsidy.name}</div>
                                    <div style="font-size: 20px; font-weight: 800; color: #C8A97E;">${item.totalAmount.toLocaleString()}ì›</div>
                                </div>
                                <div style="font-size: 12px; color: #555; margin-bottom: 12px; line-height: 1.5;">${item.details}</div>
                                <div style="background: #f8faf8; padding: 14px 16px; border-radius: 8px; font-size: 11px; line-height: 1.6;">
                                    <div style="display: flex; margin-bottom: 8px;">
                                        <span style="color: #166534; font-weight: 600; min-width: 70px;">ğŸ“ ì‹ ì²­ì²˜</span>
                                        <span style="color: #333; flex: 1;">${item.subsidy.applicationMethod || 'ê³ ìš©24'}</span>
                                    </div>
                                    <div style="display: flex; margin-bottom: 8px;">
                                        <span style="color: #166534; font-weight: 600; min-width: 70px;">ğŸ“ ë¬¸ì˜ì²˜</span>
                                        <span style="color: #333;">${item.subsidy.contact || 'ê³ ìš©ë…¸ë™ë¶€ 1350'}</span>
                                    </div>
                                    <div style="margin-bottom: 4px;">
                                        <span style="color: #166534; font-weight: 600;">ğŸ“‹ í•„ìš”ì„œë¥˜</span>
                                    </div>
                                    ${docsHtml}
                                </div>
                            </div>
                        `}).join('');

                        pageHtml = `
                            <div style="${baseStyle} display: flex; flex-direction: column;">
                                ${createHeader('ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ ìƒì„¸' + (pages.filter(p => p.type === 'eligible').length > 1 ? ` (${pages.filter((p, idx) => p.type === 'eligible' && idx < i).length + 1}/${pages.filter(p => p.type === 'eligible').length})` : ''))}
                                <div style="flex: 1; padding: 30px 50px; display: flex; flex-direction: column; justify-content: center;">
                                    ${itemsHtml}
                                </div>
                                ${createFooter(i + 1, totalPages)}
                            </div>
                        `;
                    } else if (page.type === 'notEligible') {
                        // ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ í˜ì´ì§€ - ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬
                        const excludedHtml = page.excludedItems.length > 0 ? `
                            <div style="margin-bottom: 25px;">
                                <div style="font-size: 14px; font-weight: 700; color: #ea580c; margin-bottom: 12px; padding: 10px 14px; background: linear-gradient(135deg, #fff7ed 0%, #fff 100%); border-radius: 8px; display: inline-block;">
                                    âš ï¸ ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ (ë” ìœ ë¦¬í•œ ëŒ€ì•ˆ ì„ íƒë¨)
                                </div>
                                ${page.excludedItems.map(item => `
                                    <div style="background: #fff7ed; padding: 14px 18px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #f97316;">
                                        <div style="font-size: 13px; font-weight: 600; color: #c2410c; margin-bottom: 4px;">${item.subsidy.name}</div>
                                        <div style="font-size: 11px; color: #166534;">ë” ìœ ë¦¬: ${item.betterOption} (+${item.amountDiff.toLocaleString()}ì›)</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '';

                        const notEligibleHtml = page.items.length > 0 ? `
                            <div>
                                ${page.isFirst ? `<div style="font-size: 14px; font-weight: 700; color: #b91c1c; margin-bottom: 12px;">ìê²© ìš”ê±´ ë¯¸ì¶©ì¡± (${notEligibleItems.length}ê°œ)</div>` : ''}
                                ${page.items.map(item => `
                                    <div style="background: #fef2f2; padding: 12px 16px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #ef4444;">
                                        <div style="font-size: 12px; font-weight: 600; color: #b91c1c; margin-bottom: 4px;">${item.subsidy.name}</div>
                                        <div style="font-size: 11px; color: #555;">ë¯¸ì¶©ì¡±: ${item.reasons.join(', ')}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '';

                        pageHtml = `
                            <div style="${baseStyle} display: flex; flex-direction: column;">
                                ${createHeader('ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ')}
                                <div style="flex: 1; padding: 40px 50px; display: flex; flex-direction: column; justify-content: center;">
                                    ${excludedHtml}
                                    ${notEligibleHtml}
                                </div>
                                ${createFooter(i + 1, totalPages)}
                            </div>
                        `;
                    } else if (page.type === 'guide') {
                        // ì‹ ì²­ ì•ˆë‚´ í˜ì´ì§€ - ê³ ê¸‰ ìŠ¤íƒ€ì¼
                        pageHtml = `
                            <div style="${baseStyle} display: flex; flex-direction: column;">
                                ${createHeader('ì‹ ì²­ ì ˆì°¨ ë° ìœ ì˜ì‚¬í•­')}
                                <div style="flex: 1; padding: 40px 50px; display: flex; flex-direction: column; justify-content: center;">
                                    <!-- ì‹ ì²­ ì ˆì°¨ -->
                                    <div style="margin-bottom: 35px;">
                                        <div style="font-size: 16px; font-weight: 700; color: #3D3D3D; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 3px solid #C8A97E; display: inline-block;">ğŸ“‹ ì‹ ì²­ ì ˆì°¨</div>
                                        <table style="width: 100%; border-collapse: collapse; font-size: 13px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border-radius: 10px; overflow: hidden;">
                                            <tr style="background: linear-gradient(135deg, #3D3D3D 0%, #2D2D2D 100%); color: #C8A97E;">
                                                <td style="padding: 14px 16px; font-weight: 600; width: 80px;">ë‹¨ê³„</td>
                                                <td style="padding: 14px 16px; font-weight: 600;">ë‚´ìš©</td>
                                                <td style="padding: 14px 16px; font-weight: 600; width: 160px;">ë¹„ê³ </td>
                                            </tr>
                                            <tr style="background: #fff;"><td style="padding: 14px 16px; color: #C8A97E; font-weight: 700;">1ë‹¨ê³„</td><td style="padding: 14px 16px; color: #333;">ìê²© ìš”ê±´ í™•ì¸</td><td style="padding: 14px 16px; color: #666;">ë³¸ ë¶„ì„ê²°ê³¼ ì°¸ì¡°</td></tr>
                                            <tr style="background: #fafafa;"><td style="padding: 14px 16px; color: #C8A97E; font-weight: 700;">2ë‹¨ê³„</td><td style="padding: 14px 16px; color: #333;">í•„ìš” ì„œë¥˜ ì¤€ë¹„</td><td style="padding: 14px 16px; color: #666;">ê° ì§€ì›ê¸ˆë³„ í™•ì¸</td></tr>
                                            <tr style="background: #fff;"><td style="padding: 14px 16px; color: #C8A97E; font-weight: 700;">3ë‹¨ê³„</td><td style="padding: 14px 16px; color: #333;">ì˜¨ë¼ì¸/ë°©ë¬¸ ì‹ ì²­</td><td style="padding: 14px 16px; color: #666;">ê³ ìš©24 ë˜ëŠ” ê³ ìš©ì„¼í„°</td></tr>
                                            <tr style="background: #fafafa;"><td style="padding: 14px 16px; color: #C8A97E; font-weight: 700;">4ë‹¨ê³„</td><td style="padding: 14px 16px; color: #333;">ì‹¬ì‚¬ ë° ìŠ¹ì¸</td><td style="padding: 14px 16px; color: #666;">í†µìƒ 2~4ì£¼ ì†Œìš”</td></tr>
                                            <tr style="background: #fff;"><td style="padding: 14px 16px; color: #C8A97E; font-weight: 700;">5ë‹¨ê³„</td><td style="padding: 14px 16px; color: #333;">ì§€ì›ê¸ˆ ì§€ê¸‰</td><td style="padding: 14px 16px; color: #666;">ìŠ¹ì¸ í›„ ê³„ì¢Œ ì…ê¸ˆ</td></tr>
                                        </table>
                                    </div>

                                    <!-- ë¬¸ì˜ì²˜ -->
                                    <div style="margin-bottom: 35px;">
                                        <div style="font-size: 16px; font-weight: 700; color: #3D3D3D; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 3px solid #C8A97E; display: inline-block;">ğŸ“ ì£¼ìš” ë¬¸ì˜ì²˜</div>
                                        <div style="display: flex; gap: 20px;">
                                            <div style="flex: 1; background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%); padding: 24px 20px; border-radius: 12px; text-align: center; box-shadow: 0 3px 12px rgba(0,0,0,0.06);">
                                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">ê³ ìš©ë…¸ë™ë¶€ ì½œì„¼í„°</div>
                                                <div style="font-size: 28px; font-weight: 800; color: #C8A97E;">1350</div>
                                            </div>
                                            <div style="flex: 1; background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%); padding: 24px 20px; border-radius: 12px; text-align: center; box-shadow: 0 3px 12px rgba(0,0,0,0.06);">
                                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">í•œêµ­ì¥ì• ì¸ê³ ìš©ê³µë‹¨</div>
                                                <div style="font-size: 28px; font-weight: 800; color: #C8A97E;">1588-1519</div>
                                            </div>
                                            <div style="flex: 1; background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%); padding: 24px 20px; border-radius: 12px; text-align: center; box-shadow: 0 3px 12px rgba(0,0,0,0.06);">
                                                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">ê³ ìš©24 í™ˆí˜ì´ì§€</div>
                                                <div style="font-size: 16px; font-weight: 700; color: #C8A97E;">www.work24.go.kr</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ìœ ì˜ì‚¬í•­ -->
                                    <div style="background: linear-gradient(135deg, #fef2f2 0%, #fff 100%); padding: 24px 28px; border-radius: 12px; border-left: 5px solid #ef4444; box-shadow: 0 3px 12px rgba(239,68,68,0.08);">
                                        <div style="font-size: 15px; font-weight: 700; color: #b91c1c; margin-bottom: 14px;">âš ï¸ ê³µí†µ ìœ ì˜ì‚¬í•­</div>
                                        <ul style="margin: 0; padding-left: 20px; font-size: 12px; color: #555; line-height: 1.9;">
                                            <li>ì›”í‰ê·  ë³´ìˆ˜ 124ë§Œì› ë¯¸ë§Œ ê·¼ë¡œìëŠ” ëŒ€ë¶€ë¶„ì˜ ì§€ì›ê¸ˆì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</li>
                                            <li>ì‚¬ì—…ì£¼ì˜ ë°°ìš°ì, ì§ê³„ ì¡´ë¹„ì†ì€ ì§€ì› ëŒ€ìƒì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</li>
                                            <li>ì™¸êµ­ì¸ ê·¼ë¡œìëŠ” F-2, F-5, F-6 ë¹„ì ì†Œì§€ìë§Œ ì§€ì› ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                                            <li>ê³ ìš©ë³´í—˜ ê°€ì…ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</li>
                                            <li>ê³µê³µê¸°ê´€, ìœ í¥ì£¼ì ì—…, ì‚¬í–‰ì‹œì„¤ì—… ë“±ì€ ì§€ì› ì œì™¸ ì—…ì¢…ì…ë‹ˆë‹¤.</li>
                                        </ul>
                                    </div>

                                    <!-- ë©´ì±… -->
                                    <div style="margin-top: 30px; text-align: center; color: #999; font-size: 11px;">
                                        â€» ë³¸ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ìˆ˜ê¸‰ ì—¬ë¶€ëŠ” ê³ ìš©ì„¼í„° ì‹¬ì‚¬ë¥¼ í†µí•´ ê²°ì •ë©ë‹ˆë‹¤.
                                    </div>
                                </div>
                                ${createFooter(i + 1, totalPages)}
                            </div>
                        `;
                    }

                    // í˜ì´ì§€ ë Œë”ë§ ë° PDFì— ì¶”ê°€
                    const imgData = await renderPage(pageHtml);

                    if (i > 0) {
                        doc.addPage();
                    }
                    doc.addImage(imgData, 'JPEG', 0, 0, 210, 297);
                }

                // PDF ì €ì¥
                const fileName = currentResults.companyData.companyName
                    ? `${currentResults.companyData.companyName}_ê³ ìš©ì§€ì›ê¸ˆ_ë¶„ì„_${new Date().toISOString().slice(0,10)}.pdf`
                    : `ê³ ìš©ì§€ì›ê¸ˆ_ë¶„ì„ê²°ê³¼_${new Date().toISOString().slice(0,10)}.pdf`;
                doc.save(fileName);

                btn.textContent = originalText;
                btn.disabled = false;
            } catch (error) {
                console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                btn.textContent = originalText;
                btn.disabled = false;
                alert('PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
    </script>
</body>
</html>
