<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ê³ ìš©ì§€ì›ê¸ˆ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        label {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label span {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }
        select, input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        .btn-success {
            background: #34a853;
            color: white;
        }
        .btn-danger {
            background: #ea4335;
            color: white;
        }
        .hidden { display: none; }
        .results-summary {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            margin-bottom: 20px;
        }
        .results-summary .amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .subsidy-list { list-style: none; }
        .subsidy-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .subsidy-item.eligible {
            background: #e6f4ea;
            border-color: #34a853;
        }
        .subsidy-item.not-eligible {
            background: #fce8e6;
            border-color: #ea4335;
        }
        .subsidy-item h4 { margin-bottom: 5px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .subsidy-item p { color: #666; font-size: 0.9rem; }
        .verification-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-confirmed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .badge-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .verification-source {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.5rem; }
            .results-summary .amount { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>2026 ê³ ìš©ì§€ì›ê¸ˆ ë¶„ì„ ì‹œìŠ¤í…œ</h1>

        <div class="card">
            <h2>ê¸°ì—… ì •ë³´ ì…ë ¥</h2>
            <form id="companyForm">
                <div class="form-grid">
                    <label>
                        <span>ì§€ì—­</span>
                        <select id="region" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì„œìš¸">ì„œìš¸</option>
                            <option value="ê²½ê¸°">ê²½ê¸°</option>
                            <option value="ì¸ì²œ">ì¸ì²œ</option>
                            <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                            <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                            <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                            <option value="ëŒ€ì „">ëŒ€ì „</option>
                            <option value="ìš¸ì‚°">ìš¸ì‚°</option>
                            <option value="ì„¸ì¢…">ì„¸ì¢…</option>
                            <option value="ê°•ì›">ê°•ì›</option>
                            <option value="ì¶©ë¶">ì¶©ë¶</option>
                            <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
                            <option value="ì „ë¶">ì „ë¶</option>
                            <option value="ì „ë‚¨">ì „ë‚¨</option>
                            <option value="ê²½ë¶">ê²½ë¶</option>
                            <option value="ê²½ë‚¨">ê²½ë‚¨</option>
                            <option value="ì œì£¼">ì œì£¼</option>
                        </select>
                    </label>
                    <label>
                        <span>ì§€ì—­ ìœ í˜•</span>
                        <select id="regionType" required>
                            <option value="ìˆ˜ë„ê¶Œ">ìˆ˜ë„ê¶Œ</option>
                            <option value="ë¹„ìˆ˜ë„ê¶Œ">ë¹„ìˆ˜ë„ê¶Œ</option>
                        </select>
                    </label>
                    <label>
                        <span>ì—…ì¢…</span>
                        <select id="industry" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì œì¡°ì—…">ì œì¡°ì—…</option>
                            <option value="ê±´ì„¤ì—…">ê±´ì„¤ì—…</option>
                            <option value="ë„ì†Œë§¤ì—…">ë„ì†Œë§¤ì—…</option>
                            <option value="ìˆ™ë°•ìŒì‹ì—…">ìˆ™ë°•ìŒì‹ì—…</option>
                            <option value="ì •ë³´í†µì‹ ì—…">ì •ë³´í†µì‹ ì—…</option>
                            <option value="ì „ë¬¸ê³¼í•™ê¸°ìˆ ì—…">ì „ë¬¸ê³¼í•™ê¸°ìˆ ì—…</option>
                            <option value="ì‚¬ì—…ì„œë¹„ìŠ¤ì—…">ì‚¬ì—…ì„œë¹„ìŠ¤ì—…</option>
                            <option value="ë†ì—…/ì„ì—…/ì–´ì—…">ë†ì—…/ì„ì—…/ì–´ì—…</option>
                            <option value="ê´‘ì—…">ê´‘ì—…</option>
                            <option value="ì „ê¸°/ê°€ìŠ¤/ìˆ˜ë„">ì „ê¸°/ê°€ìŠ¤/ìˆ˜ë„</option>
                            <option value="ìš´ìˆ˜/ì°½ê³ ì—…">ìš´ìˆ˜/ì°½ê³ ì—…</option>
                            <option value="ê¸ˆìœµ/ë³´í—˜ì—…">ê¸ˆìœµ/ë³´í—˜ì—…</option>
                            <option value="ë¶€ë™ì‚°ì—…">ë¶€ë™ì‚°ì—…</option>
                            <option value="êµìœ¡ì„œë¹„ìŠ¤ì—…">êµìœ¡ì„œë¹„ìŠ¤ì—…</option>
                            <option value="ë³´ê±´/ì‚¬íšŒë³µì§€">ë³´ê±´/ì‚¬íšŒë³µì§€</option>
                            <option value="ì˜ˆìˆ /ìŠ¤í¬ì¸ ">ì˜ˆìˆ /ìŠ¤í¬ì¸ </option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </label>
                    <label>
                        <span>ì´ ì§ì›ìˆ˜</span>
                        <input type="number" id="totalEmployees" min="1" value="10" required>
                    </label>
                    <label>
                        <span>ì²­ë…„ (15~34ì„¸)</span>
                        <input type="number" id="youthEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ì¤‘ì¥ë…„ (50~59ì„¸)</span>
                        <input type="number" id="middleAgedEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ê³ ë ¹ì (60ì„¸+)</span>
                        <input type="number" id="seniorEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ì¥ì• ì¸</span>
                        <input type="number" id="disabledEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ì¤‘ì¦ì¥ì• ì¸</span>
                        <input type="number" id="severeDisabledEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ìœ¡ì•„ê¸° ê·¼ë¡œì</span>
                        <input type="number" id="childcareWorkers" min="0" value="0">
                    </label>
                    <label>
                        <span>ë¹„ì •ê·œì§ (ì „í™˜ ì˜ˆì •)</span>
                        <input type="number" id="nonRegularEmployees" min="0" value="0">
                    </label>
                    <label>
                        <span>ì •ë…„ ê·œì • ìœ ë¬´</span>
                        <select id="hasRetirementAge">
                            <option value="false">ì—†ìŒ</option>
                            <option value="true">ìˆìŒ</option>
                        </select>
                    </label>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn-primary">ì§€ì›ê¸ˆ ë¶„ì„í•˜ê¸°</button>
                    <button type="reset" class="btn-secondary">ì´ˆê¸°í™”</button>
                </div>
            </form>
        </div>

        <div id="results" class="hidden">
            <div class="card">
                <div class="results-summary">
                    <h3>ì´ ì˜ˆìƒ ìˆ˜ê¸‰ì•¡</h3>
                    <div class="amount" id="totalAmount">0ì›</div>
                    <p>ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ <span id="eligibleCount">0</span>ê°œ</p>
                </div>

                <div class="btn-group" style="justify-content: center;">
                    <button id="exportExcel" class="btn-success">Excel ë‹¤ìš´ë¡œë“œ</button>
                    <button id="exportPdf" class="btn-danger">PDF ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>

            <div class="card">
                <h2>ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ</h2>
                <ul class="subsidy-list" id="eligibleList"></ul>
            </div>

            <div class="card">
                <h2>ì§€ì›ê¸ˆ ë¹„êµ</h2>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ</h2>
                <ul class="subsidy-list" id="notEligibleList"></ul>
            </div>
        </div>

    </div>

    <script>
        let currentResults = null;
        let subsidyData = null;
        let chart = null;

        // ì§€ì›ê¸ˆ ë°ì´í„° ë¡œë“œ
        async function loadSubsidyData() {
            const response = await fetch('/subsidies-2026.json');
            subsidyData = await response.json();
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            await loadSubsidyData();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('companyForm').addEventListener('submit', handleSubmit);
            document.getElementById('companyForm').addEventListener('reset', handleReset);
            document.getElementById('exportExcel').addEventListener('click', exportExcel);
            document.getElementById('exportPdf').addEventListener('click', exportPdf);

            // ì§€ì—­ ì„ íƒ ì‹œ ì§€ì—­ ìœ í˜• ìë™ ì„¤ì •
            document.getElementById('region').addEventListener('change', (e) => {
                const metro = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ'];
                document.getElementById('regionType').value = metro.includes(e.target.value) ? 'ìˆ˜ë„ê¶Œ' : 'ë¹„ìˆ˜ë„ê¶Œ';
            });
        }

        function handleReset() {
            document.getElementById('results').classList.add('hidden');
            currentResults = null;
            if (chart) {
                chart.destroy();
                chart = null;
            }
        }

        async function handleSubmit(e) {
            e.preventDefault();

            const companyData = {
                region: document.getElementById('region').value,
                regionType: document.getElementById('regionType').value,
                industry: document.getElementById('industry').value,
                totalEmployees: parseInt(document.getElementById('totalEmployees').value) || 0,
                youthEmployees: parseInt(document.getElementById('youthEmployees').value) || 0,
                middleAgedEmployees: parseInt(document.getElementById('middleAgedEmployees').value) || 0,
                seniorEmployees: parseInt(document.getElementById('seniorEmployees').value) || 0,
                disabledEmployees: parseInt(document.getElementById('disabledEmployees').value) || 0,
                severeDisabledEmployees: parseInt(document.getElementById('severeDisabledEmployees').value) || 0,
                childcareWorkers: parseInt(document.getElementById('childcareWorkers').value) || 0,
                nonRegularEmployees: parseInt(document.getElementById('nonRegularEmployees').value) || 0,
                hasRetirementAge: document.getElementById('hasRetirementAge').value === 'true'
            };

            const result = analyzeEligibility(companyData, subsidyData.subsidies);
            currentResults = { companyData, ...result };
            displayResults(currentResults);
        }

        function analyzeEligibility(company, subsidies) {
            const eligible = [];
            const notEligible = [];
            const calculations = [];

            for (const subsidy of subsidies) {
                const check = checkEligibility(company, subsidy);
                if (check.isEligible) {
                    eligible.push({ subsidy, reasons: [] });
                    const calc = calculateAmount(company, subsidy);
                    calculations.push(calc);
                } else {
                    notEligible.push({ subsidy, reasons: check.reasons });
                }
            }

            calculations.sort((a, b) => b.totalAmount - a.totalAmount);
            const optimal = findOptimalCombination(calculations, subsidies);

            return {
                eligibility: { eligible, notEligible },
                calculations,
                optimal,
                excludedByConflict: optimal.excluded || []
            };
        }

        function checkEligibility(company, subsidy) {
            const reasons = [];
            const elig = subsidy.eligibility;

            if (elig.minEmployees && company.totalEmployees < elig.minEmployees) {
                reasons.push(`ìµœì†Œ ${elig.minEmployees}ì¸ ì´ìƒ í•„ìš” (í˜„ì¬ ${company.totalEmployees}ì¸)`);
            }
            if (elig.maxEmployees && company.totalEmployees > elig.maxEmployees) {
                reasons.push(`${elig.maxEmployees}ì¸ ì´í•˜ ê¸°ì—…ë§Œ ê°€ëŠ¥ (í˜„ì¬ ${company.totalEmployees}ì¸)`);
            }
            if (elig.requiredEmployeeTypes && elig.requiredEmployeeTypes.length > 0) {
                for (const type of elig.requiredEmployeeTypes) {
                    if (type === 'ì²­ë…„' && !company.youthEmployees) reasons.push('ì²­ë…„ ê·¼ë¡œì(15~34ì„¸)ê°€ í•„ìš”í•©ë‹ˆë‹¤');
                    if (type === 'ê³ ë ¹ì' && !company.seniorEmployees) reasons.push('ê³ ë ¹ì ê·¼ë¡œì(60ì„¸+)ê°€ í•„ìš”í•©ë‹ˆë‹¤');
                    if (type === 'ì¥ì• ì¸' && !company.disabledEmployees && !company.severeDisabledEmployees) reasons.push('ì¥ì• ì¸ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
                    if (type === '50ì„¸ ì´ìƒ ì¤‘ì¥ë…„' && !company.middleAgedEmployees && !company.seniorEmployees) reasons.push('50ì„¸ ì´ìƒ ì¤‘ì¥ë…„ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
                }
            }
            if (elig.requiresRetirementAge && !company.hasRetirementAge) reasons.push('ì •ë…„ ê·œì •ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤');
            if (elig.requiresSevereDisabled && !company.severeDisabledEmployees) reasons.push('ì¤‘ì¦ì¥ì• ì¸ ê·¼ë¡œìê°€ í•„ìš”í•©ë‹ˆë‹¤');
            if (elig.targetIndustries && elig.targetIndustries.length > 0) {
                const isMatch = elig.targetIndustries.some(ind => company.industry.includes(ind) || ind.includes(company.industry));
                if (!isMatch) reasons.push(`ëŒ€ìƒ ì—…ì¢…: ${elig.targetIndustries.join(', ')}`);
            }
            if (elig.forJobSeekers) reasons.push('êµ¬ì§ì ëŒ€ìƒ ì§€ì›ê¸ˆ (ê¸°ì—… ëŒ€ìƒ ì•„ë‹˜)');

            return { isEligible: reasons.length === 0, reasons };
        }

        function calculateAmount(company, subsidy) {
            let totalAmount = 0;
            let details = '';
            const calc = subsidy.calculation;

            switch (calc.type) {
                case 'regional-differentiated-2026':
                    const companyAmount = calc.company.amount * (company.youthEmployees || 1);
                    let youthAmount = 0;
                    const regionType = company.regionType || 'ìˆ˜ë„ê¶Œ';
                    if (calc.youth[regionType]) {
                        youthAmount = calc.youth[regionType].totalAmount * (company.youthEmployees || 1);
                    }
                    totalAmount = companyAmount + youthAmount;
                    details = `ê¸°ì—…ì§€ì› ${(calc.company.amount / 10000).toLocaleString()}ë§Œì› Ã— ${company.youthEmployees || 1}ëª…`;
                    break;
                case 'regional-differentiated-quarterly':
                    const isMetro = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ'].includes(company.region);
                    const regionCalc = isMetro ? calc['ìˆ˜ë„ê¶Œ'] : calc['ë¹„ìˆ˜ë„ê¶Œ'];
                    totalAmount = regionCalc.totalAmount * (company.seniorEmployees || 1);
                    details = `${isMetro ? 'ìˆ˜ë„ê¶Œ' : 'ë¹„ìˆ˜ë„ê¶Œ'} ì›” ${(regionCalc.monthlyAmount / 10000)}ë§Œì› Ã— ${regionCalc.maxYears}ë…„ Ã— ${company.seniorEmployees || 1}ëª…`;
                    break;
                case 'per-employee-monthly-by-gender':
                    totalAmount = calc['ì¤‘ì¦ë‚¨ì„±'].totalAmount * (company.severeDisabledEmployees || 0);
                    details = `ì¤‘ì¦ì¥ì• ì¸ ${company.severeDisabledEmployees || 0}ëª… Ã— ì›” ${(calc['ì¤‘ì¦ë‚¨ì„±'].monthlyAmount / 10000)}ë§Œì› Ã— 12ê°œì›”`;
                    break;
                case 'per-employee-monthly':
                    // ì§€ì›ê¸ˆ ì¢…ë¥˜ì— ë”°ë¼ ì ìš© ëŒ€ìƒ ê²°ì •
                    let targetCount = 1;
                    let targetLabel = 'ê·¼ë¡œì';

                    if (subsidy.id === 'parental-10am-work-2026' || subsidy.id === 'work-life-balance-incentive-2026') {
                        targetCount = company.childcareWorkers || 1;
                        targetLabel = 'ìœ¡ì•„ê¸° ê·¼ë¡œì';
                    } else if (subsidy.id === 'flexible-work-incentive-2026') {
                        // ìœ ì—°ê·¼ë¬´ëŠ” ì „ì²´ ì§ì› ì¤‘ 30% í•œë„
                        targetCount = Math.min(Math.floor(company.totalEmployees * 0.3), 300) || 1;
                        targetLabel = 'ìœ ì—°ê·¼ë¬´ í™œìš©ì';
                    } else if (subsidy.id === 'work-life-balance-45-project-2026') {
                        // ì›Œë¼ë°¸ 4.5ëŠ” ìµœëŒ€ 50ëª…
                        targetCount = Math.min(company.totalEmployees, 50) || 1;
                        targetLabel = 'ì£¼4.5ì¼ ì ìš©ì';
                    } else {
                        targetCount = company.childcareWorkers || 1;
                        targetLabel = 'ëŒ€ìƒ ê·¼ë¡œì';
                    }

                    const monthlyAmt = calc.monthlyAmount || (calc.monthlyAmounts ? calc.monthlyAmounts['ì¬íƒì›ê²©ê·¼ë¬´'] : 300000);
                    const maxMonths = calc.maxMonths || 12;
                    totalAmount = monthlyAmt * maxMonths * targetCount;
                    details = `${targetLabel} ${targetCount}ëª… Ã— ì›” ${(monthlyAmt / 10000)}ë§Œì› Ã— ${maxMonths}ê°œì›”`;
                    break;
                case 'one-time':
                    // ì¼Â·ê°€ì •ì–‘ë¦½ í™˜ê²½ê°œì„  ì‹œìŠ¤í…œêµ¬ì¶•ë¹„ ë“± 1íšŒì„± ì§€ì›
                    totalAmount = calc.maxAmount || 0;
                    details = calc.description || `ìµœëŒ€ ${(totalAmount / 10000).toLocaleString()}ë§Œì› (1íšŒ)`;
                    break;
                case 'milestone-based':
                    const middleAged = (company.middleAgedEmployees || 0) + (company.seniorEmployees || 0);
                    totalAmount = calc.totalAmount * middleAged;
                    details = `50ì„¸+ ì¤‘ì¥ë…„ ${middleAged}ëª… Ã— ${(calc.totalAmount / 10000).toLocaleString()}ë§Œì›`;
                    break;
                case 'company-size-differentiated':
                    // ê³ ìš©ì´‰ì§„ì¥ë ¤ê¸ˆ - ê¸°ì—… ê·œëª¨ë³„ ì°¨ë“± ì§€ì›
                    const companyTypeCalc = calc['ìš°ì„ ì§€ì›ëŒ€ìƒê¸°ì—…'] || calc['ì¤‘ê²¬ê¸°ì—…'];
                    totalAmount = companyTypeCalc.totalAmount;
                    details = `ì·¨ì—…ì·¨ì•½ê³„ì¸µ ì±„ìš© ì‹œ ì—° ìµœëŒ€ ${(companyTypeCalc.totalAmount / 10000).toLocaleString()}ë§Œì›`;
                    break;
                case 'multi-component':
                    // ì¶œì‚°ìœ¡ì•„ê¸° ê³ ìš©ì•ˆì •ì¥ë ¤ê¸ˆ - ë³µìˆ˜ êµ¬ì„±ìš”ì†Œ
                    if (calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ']) {
                        const childcareCount = company.childcareWorkers || 1;
                        // ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ ê¸°ë³¸
                        const baseSupport = calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ']['ê¸°ë³¸'];
                        if (baseSupport) {
                            totalAmount = baseSupport.totalAmount * childcareCount;
                            details = `ìœ¡ì•„íœ´ì§ ì—° ${(baseSupport.totalAmount / 10000)}ë§Œì› Ã— ${childcareCount}ëª…`;
                        } else {
                            // ì´ì „ êµ¬ì¡° í˜¸í™˜
                            totalAmount = (calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ'].monthlyAmount || 300000) * 12 * childcareCount;
                            details = `ìœ¡ì•„íœ´ì§ ì›” ${((calc['ìœ¡ì•„íœ´ì§ì§€ì›ê¸ˆ'].monthlyAmount || 300000) / 10000)}ë§Œì› Ã— ${childcareCount}ëª…`;
                        }
                    }
                    break;
                case 'per-employee-monthly-by-severity':
                    // ì¥ì• ì¸ê³ ìš©ì¥ë ¤ê¸ˆ - ì¥ì• ë“±ê¸‰/ì„±ë³„ë³„ ì°¨ë“±
                    const mildDisabledCount = company.disabledEmployees || 0;
                    const severeDisabledCount = company.severeDisabledEmployees || 0;
                    const totalDisabledCount = mildDisabledCount + severeDisabledCount;

                    // ê²½ì¦ í‰ê· : (40ë§Œ + 30ë§Œ) / 2 = 35ë§Œì›
                    // ì¤‘ì¦ í‰ê· : (60ë§Œ + 50ë§Œ) / 2 = 55ë§Œì›
                    const mildAvg = calc['ê²½ì¦ë‚¨ì„±'] && calc['ê²½ì¦ì—¬ì„±']
                        ? (calc['ê²½ì¦ë‚¨ì„±'].monthlyAmount + calc['ê²½ì¦ì—¬ì„±'].monthlyAmount) / 2
                        : 350000;
                    const severeAvg = calc['ì¤‘ì¦ë‚¨ì„±'] && calc['ì¤‘ì¦ì—¬ì„±']
                        ? (calc['ì¤‘ì¦ë‚¨ì„±'].monthlyAmount + calc['ì¤‘ì¦ì—¬ì„±'].monthlyAmount) / 2
                        : 550000;

                    const mildDisabledAmount = mildAvg * 12 * mildDisabledCount;
                    const severeDisabledAmount = severeAvg * 12 * severeDisabledCount;
                    totalAmount = mildDisabledAmount + severeDisabledAmount;

                    // ìƒì„¸ ë‚´ì—­ ì‘ì„±
                    if (mildDisabledCount > 0 && severeDisabledCount > 0) {
                        details = `ê²½ì¦ ${mildDisabledCount}ëª… Ã— ì›” ${(mildAvg / 10000)}ë§Œì› Ã— 12ê°œì›” + ì¤‘ì¦ ${severeDisabledCount}ëª… Ã— ì›” ${(severeAvg / 10000)}ë§Œì› Ã— 12ê°œì›”`;
                    } else if (severeDisabledCount > 0) {
                        details = `ì¤‘ì¦ì¥ì• ì¸ ${severeDisabledCount}ëª… Ã— ì›” ${(severeAvg / 10000)}ë§Œì› Ã— 12ê°œì›”`;
                    } else {
                        details = `ê²½ì¦ì¥ì• ì¸ ${mildDisabledCount}ëª… Ã— ì›” ${(mildAvg / 10000)}ë§Œì› Ã— 12ê°œì›”`;
                    }
                    break;
                case 'monthly-based-on-wage-increase':
                    // ì •ê·œì§ ì „í™˜ ì§€ì›ê¸ˆ
                    const conversionCalc = calc['ì„ê¸ˆ20ë§Œì›ì´ìƒì¸ìƒ'] || calc['ê·¸ì™¸'];
                    totalAmount = conversionCalc.totalAmount * (company.nonRegularEmployees || 1);
                    details = `ë¹„ì •ê·œì§ ì „í™˜ ${company.nonRegularEmployees || 1}ëª… Ã— ${(conversionCalc.totalAmount / 10000).toLocaleString()}ë§Œì›`;
                    break;
                case 'monthly-jobseeker-support':
                    // êµ¬ì§ì ì§€ì› (êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„, ì¥ì• ì¸ì·¨ì—…ì„±ê³µíŒ¨í‚¤ì§€ ë“±)
                    totalAmount = calc.totalAmount || 0;
                    details = calc.description || '';
                    break;
                default:
                    if (calc.totalAmount) {
                        totalAmount = calc.totalAmount;
                        details = calc.description || '';
                    } else if (calc.monthlyAmount) {
                        totalAmount = calc.monthlyAmount * (calc.maxMonths || 12);
                        details = calc.description || '';
                    }
            }

            return { subsidy, totalAmount, details };
        }

        function findOptimalCombination(calculations, allSubsidies) {
            if (calculations.length === 0) return { combination: [], totalAmount: 0, excluded: [] };

            // ê¸ˆì•¡ì´ í° ìˆœìœ¼ë¡œ ì •ë ¬
            const sorted = [...calculations].sort((a, b) => b.totalAmount - a.totalAmount);

            const combination = [];
            const excluded = []; // ì¤‘ë³µìœ¼ë¡œ ì œì™¸ëœ ì§€ì›ê¸ˆ
            let totalAmount = 0;
            const usedExclusions = new Set();
            const selectedIds = new Set();

            for (const calc of sorted) {
                const exclusions = calc.subsidy.mutuallyExclusive || [];

                // ì´ë¯¸ ì„ íƒëœ ì§€ì›ê¸ˆê³¼ ì¤‘ë³µ ì²´í¬
                const conflictWith = exclusions.find(ex => selectedIds.has(ex));

                if (conflictWith) {
                    // ì¤‘ë³µìœ¼ë¡œ ì œì™¸ë¨ - ì´ìœ  ê¸°ë¡
                    const conflictSubsidy = allSubsidies.find(s => s.id === conflictWith);
                    const selectedCalc = combination.find(c => c.subsidy.id === conflictWith);
                    excluded.push({
                        ...calc,
                        excludeReason: `'${conflictSubsidy?.name || conflictWith}'ê³¼(ì™€) ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€`,
                        betterOption: conflictSubsidy?.name,
                        betterAmount: selectedCalc?.totalAmount || 0,
                        amountDiff: (selectedCalc?.totalAmount || 0) - calc.totalAmount
                    });
                } else if (usedExclusions.has(calc.subsidy.id)) {
                    // ë‹¤ë¥¸ ì§€ì›ê¸ˆì— ì˜í•´ ì œì™¸ë¨
                    const blockedBy = combination.find(c =>
                        (c.subsidy.mutuallyExclusive || []).includes(calc.subsidy.id)
                    );
                    excluded.push({
                        ...calc,
                        excludeReason: `'${blockedBy?.subsidy.name}'ê³¼(ì™€) ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€`,
                        betterOption: blockedBy?.subsidy.name,
                        betterAmount: blockedBy?.totalAmount || 0,
                        amountDiff: (blockedBy?.totalAmount || 0) - calc.totalAmount
                    });
                } else {
                    // ì„ íƒ ê°€ëŠ¥
                    combination.push(calc);
                    totalAmount += calc.totalAmount;
                    selectedIds.add(calc.subsidy.id);
                    exclusions.forEach(ex => usedExclusions.add(ex));
                }
            }

            return { combination, totalAmount, excluded };
        }

        function getVerificationBadge(status) {
            if (status === 'confirmed2026') {
                return '<span class="verification-badge badge-confirmed">âœ… 2026ë…„ í™•ì¸</span>';
            } else if (status === 'pending2026') {
                return '<span class="verification-badge badge-pending">âš ï¸ 2025ë…„ ê¸°ì¤€</span>';
            }
            return '';
        }

        function displayResults(results) {
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('totalAmount').textContent = results.optimal.totalAmount.toLocaleString() + 'ì›';
            document.getElementById('eligibleCount').textContent = results.optimal.combination.length;

            // ìˆ˜ê¸‰ ê°€ëŠ¥ ëª©ë¡
            const eligibleList = document.getElementById('eligibleList');
            eligibleList.innerHTML = results.optimal.combination.map(item => `
                <li class="subsidy-item eligible">
                    <h4>
                        ${item.subsidy.name}
                        ${getVerificationBadge(item.subsidy.verificationStatus)}
                    </h4>
                    <p><strong>ê¸ˆì•¡:</strong> ${item.totalAmount.toLocaleString()}ì›</p>
                    <p><strong>ì‚°ì¶œ:</strong> ${item.details}</p>
                    ${item.subsidy.verificationSource ? `<p class="verification-source">ğŸ“‹ ${item.subsidy.verificationSource}</p>` : ''}
                </li>
            `).join('');

            // ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ë¡œ ì œì™¸ëœ ì§€ì›ê¸ˆ (ë” ì¢‹ì€ ëŒ€ì•ˆ ì„ íƒë¨)
            const excludedByConflict = results.excludedByConflict || [];
            if (excludedByConflict.length > 0) {
                const excludedHtml = excludedByConflict.map(item => `
                    <li class="subsidy-item excluded-conflict" style="background: #fff3e0; border-left: 4px solid #ff9800;">
                        <h4>
                            ${item.subsidy.name}
                            <span style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">ì¤‘ë³µ ì œì™¸</span>
                        </h4>
                        <p><strong>ì˜ˆìƒ ê¸ˆì•¡:</strong> ${item.totalAmount.toLocaleString()}ì›</p>
                        <p style="color: #e65100;"><strong>âš ï¸ ì œì™¸ ì‚¬ìœ :</strong> ${item.excludeReason}</p>
                        <p style="color: #2e7d32;"><strong>âœ… ë” ìœ ë¦¬í•œ ì„ íƒ:</strong> '${item.betterOption}' (${item.betterAmount.toLocaleString()}ì›) - <strong>${item.amountDiff >= 0 ? '+' : ''}${item.amountDiff.toLocaleString()}ì› ë” ë§ìŒ</strong></p>
                    </li>
                `).join('');

                eligibleList.innerHTML += `
                    <li style="background: #fff8e1; padding: 15px; margin-top: 20px; border-radius: 8px; list-style: none;">
                        <h4 style="color: #f57c00; margin: 0 0 10px 0;">ğŸ”„ ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ (ë” ìœ ë¦¬í•œ ëŒ€ì•ˆ ì„ íƒë¨)</h4>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${excludedHtml}
                        </ul>
                    </li>
                `;
            }

            // ìˆ˜ê¸‰ ë¶ˆê°€ ëª©ë¡
            const notEligibleList = document.getElementById('notEligibleList');
            notEligibleList.innerHTML = results.eligibility.notEligible.map(item => `
                <li class="subsidy-item not-eligible">
                    <h4>
                        ${item.subsidy.name}
                        ${getVerificationBadge(item.subsidy.verificationStatus)}
                    </h4>
                    <p><strong>ë¯¸ì¶©ì¡± ì‚¬ìœ :</strong> ${item.reasons.join(', ')}</p>
                </li>
            `).join('');

            // ì°¨íŠ¸
            renderChart(results.calculations);
        }

        function renderChart(calculations) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            if (chart) chart.destroy();

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: calculations.slice(0, 6).map(c => c.subsidy.name.substring(0, 10) + '...'),
                    datasets: [{
                        label: 'ì˜ˆìƒ ì§€ì›ê¸ˆ (ì›)',
                        data: calculations.slice(0, 6).map(c => c.totalAmount),
                        backgroundColor: ['#667eea', '#764ba2', '#34a853', '#fbbc04', '#ea4335', '#4285f4']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: v => (v / 10000).toLocaleString() + 'ë§Œì›' }
                        }
                    }
                }
            });
        }

        function exportExcel() {
            if (!currentResults) return;

            const wb = XLSX.utils.book_new();

            // ê¸°ì—… ì •ë³´
            const companySheet = [
                ['2026ë…„ ê³ ìš©ì§€ì›ê¸ˆ ë¶„ì„ ê²°ê³¼'],
                [],
                ['ê¸°ì—… ì •ë³´'],
                ['ì§€ì—­', currentResults.companyData.region],
                ['ì§€ì—­ìœ í˜•', currentResults.companyData.regionType],
                ['ì—…ì¢…', currentResults.companyData.industry],
                ['ì´ ì§ì›ìˆ˜', currentResults.companyData.totalEmployees],
                ['ì²­ë…„(15~34ì„¸)', currentResults.companyData.youthEmployees],
                ['ì¤‘ì¥ë…„(50~59ì„¸)', currentResults.companyData.middleAgedEmployees],
                ['ê³ ë ¹ì(60ì„¸+)', currentResults.companyData.seniorEmployees],
                ['ì¥ì• ì¸', currentResults.companyData.disabledEmployees],
                ['ì¤‘ì¦ì¥ì• ì¸', currentResults.companyData.severeDisabledEmployees],
                ['ìœ¡ì•„ê¸° ê·¼ë¡œì', currentResults.companyData.childcareWorkers],
                ['ë¹„ì •ê·œì§', currentResults.companyData.nonRegularEmployees],
            ];
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(companySheet), 'ê¸°ì—…ì •ë³´');

            // ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ (ìƒì„¸ ì •ë³´ í¬í•¨)
            const eligibleSheet = [
                ['ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ ìƒì„¸'],
                [],
                ['ì§€ì›ê¸ˆëª…', 'ì˜ˆìƒ ê¸ˆì•¡', 'ì‚°ì¶œ ë‚´ì—­', 'í•„ìš”ì„œë¥˜', 'ì‹ ì²­ë°©ë²•', 'ë¬¸ì˜ì²˜']
            ];
            currentResults.optimal.combination.forEach(item => {
                const docs = item.subsidy.requiredDocuments ? item.subsidy.requiredDocuments.join(' / ') : '-';
                const method = item.subsidy.applicationMethod || '-';
                const contact = item.subsidy.contact || '-';
                eligibleSheet.push([item.subsidy.name, item.totalAmount, item.details, docs, method, contact]);
            });
            eligibleSheet.push([], ['ì´ ì˜ˆìƒ ìˆ˜ê¸‰ì•¡', currentResults.optimal.totalAmount, '', '', '', '']);
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(eligibleSheet), 'ìˆ˜ê¸‰ê°€ëŠ¥ì§€ì›ê¸ˆ');

            // ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ë¡œ ì œì™¸ëœ ì§€ì›ê¸ˆ
            const excludedByConflict = currentResults.excludedByConflict || [];
            if (excludedByConflict.length > 0) {
                const conflictSheet = [
                    ['ğŸ”„ ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ (ë” ìœ ë¦¬í•œ ëŒ€ì•ˆ ì„ íƒë¨)'],
                    [],
                    ['ì§€ì›ê¸ˆëª…', 'ì˜ˆìƒ ê¸ˆì•¡', 'ì œì™¸ ì‚¬ìœ ', 'ë” ìœ ë¦¬í•œ ì„ íƒ', 'ê¸ˆì•¡ ì°¨ì´'],
                ];
                excludedByConflict.forEach(item => {
                    conflictSheet.push([
                        item.subsidy.name,
                        item.totalAmount,
                        item.excludeReason,
                        `${item.betterOption} (${item.betterAmount.toLocaleString()}ì›)`,
                        `+${item.amountDiff.toLocaleString()}ì› ë” ë§ìŒ`
                    ]);
                });
                conflictSheet.push([]);
                conflictSheet.push(['ğŸ’¡ ì•ˆë‚´: ìœ„ ì§€ì›ê¸ˆë“¤ì€ ë‹¤ë¥¸ ì§€ì›ê¸ˆê³¼ ë™ì‹œ ìˆ˜ê¸‰ì´ ë¶ˆê°€í•˜ì—¬, ê¸ˆì•¡ì´ ë” í° ì§€ì›ê¸ˆì„ ì¶”ì²œë“œë ¸ìŠµë‹ˆë‹¤.']);
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(conflictSheet), 'ì¤‘ë³µì œì™¸ì§€ì›ê¸ˆ');
            }

            // ì‹ ì²­ ì ˆì°¨ ì•ˆë‚´
            const procedureSheet = [
                ['ğŸ“‹ ì‹ ì²­ ì ˆì°¨ ì•ˆë‚´'],
                [],
                ['ë‹¨ê³„', 'ë‚´ìš©', 'ë¹„ê³ '],
                ['1ë‹¨ê³„', 'ìê²© ìš”ê±´ í™•ì¸', 'ë³¸ ë¶„ì„ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•´ë‹¹ ì§€ì›ê¸ˆ ìˆ˜ê¸‰ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸'],
                ['2ë‹¨ê³„', 'í•„ìš” ì„œë¥˜ ì¤€ë¹„', 'ê° ì§€ì›ê¸ˆë³„ í•„ìš”ì„œë¥˜ ì‚¬ì „ ì¤€ë¹„ (ì•„ë˜ ëª©ë¡ ì°¸ì¡°)'],
                ['3ë‹¨ê³„', 'ì˜¨ë¼ì¸/ë°©ë¬¸ ì‹ ì²­', 'ê³ ìš©24(www.work24.go.kr) ë˜ëŠ” ê´€í•  ê³ ìš©ì„¼í„° ë°©ë¬¸'],
                ['4ë‹¨ê³„', 'ì‹¬ì‚¬ ë° ìŠ¹ì¸', 'ì œì¶œ ì„œë¥˜ ì‹¬ì‚¬ (í†µìƒ 2~4ì£¼ ì†Œìš”)'],
                ['5ë‹¨ê³„', 'ì§€ì›ê¸ˆ ì§€ê¸‰', 'ìŠ¹ì¸ í›„ ì§€ì • ê³„ì¢Œë¡œ ì§€ê¸‰'],
                [],
                ['ğŸ“ ì£¼ìš” ë¬¸ì˜ì²˜'],
                ['ê³ ìš©ë…¸ë™ë¶€ ì½œì„¼í„°', '1350'],
                ['í•œêµ­ì¥ì• ì¸ê³ ìš©ê³µë‹¨', '1588-1519'],
                ['ê³ ìš©24 í™ˆí˜ì´ì§€', 'www.work24.go.kr'],
                [],
                ['âš ï¸ ê³µí†µ ìœ ì˜ì‚¬í•­'],
                ['1. ì›”í‰ê·  ë³´ìˆ˜ 124ë§Œì› ë¯¸ë§Œ ê·¼ë¡œìëŠ” ëŒ€ë¶€ë¶„ì˜ ì§€ì›ê¸ˆì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.'],
                ['2. ì‚¬ì—…ì£¼ì˜ ë°°ìš°ì, ì§ê³„ ì¡´ë¹„ì†ì€ ì§€ì› ëŒ€ìƒì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.'],
                ['3. ì™¸êµ­ì¸ ê·¼ë¡œìëŠ” F-2, F-5, F-6 ë¹„ì ì†Œì§€ìë§Œ ì§€ì› ê°€ëŠ¥í•©ë‹ˆë‹¤.'],
                ['4. ê³ ìš©ë³´í—˜ ê°€ì…ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.'],
                ['5. ë³¸ ë¶„ì„ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ìˆ˜ê¸‰ ì—¬ë¶€ëŠ” ê³ ìš©ì„¼í„° ì‹¬ì‚¬ë¥¼ í†µí•´ ê²°ì •ë©ë‹ˆë‹¤.'],
            ];
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(procedureSheet), 'ì‹ ì²­ì ˆì°¨ì•ˆë‚´');

            // ì§€ì›ê¸ˆë³„ ìƒì„¸ í•„ìš”ì„œë¥˜
            const docsSheet = [
                ['ğŸ“„ ì§€ì›ê¸ˆë³„ í•„ìš”ì„œë¥˜ ìƒì„¸'],
                [],
            ];
            currentResults.optimal.combination.forEach((item, idx) => {
                docsSheet.push([`${idx + 1}. ${item.subsidy.name}`]);
                docsSheet.push(['   ì‹ ì²­ë°©ë²•:', item.subsidy.applicationMethod || '-']);
                docsSheet.push(['   ë¬¸ì˜ì²˜:', item.subsidy.contact || '-']);
                docsSheet.push(['   í•„ìš”ì„œë¥˜:']);
                if (item.subsidy.requiredDocuments && item.subsidy.requiredDocuments.length > 0) {
                    item.subsidy.requiredDocuments.forEach((doc, docIdx) => {
                        docsSheet.push([`     ${docIdx + 1}. ${doc}`]);
                    });
                }
                if (item.subsidy.notes) {
                    docsSheet.push(['   ì°¸ê³ ì‚¬í•­:', item.subsidy.notes]);
                }
                docsSheet.push([]);
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(docsSheet), 'í•„ìš”ì„œë¥˜ìƒì„¸');

            // ìˆ˜ê¸‰ ë¶ˆê°€
            const notEligibleSheet = [
                ['ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ'],
                [],
                ['ì§€ì›ê¸ˆëª…', 'ë¯¸ì¶©ì¡± ì‚¬ìœ ']
            ];
            currentResults.eligibility.notEligible.forEach(item => {
                notEligibleSheet.push([item.subsidy.name, item.reasons.join(', ')]);
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(notEligibleSheet), 'ìˆ˜ê¸‰ë¶ˆê°€ì§€ì›ê¸ˆ');

            XLSX.writeFile(wb, 'ê³ ìš©ì§€ì›ê¸ˆ_ë¶„ì„ê²°ê³¼.xlsx');
        }

        async function exportPdf() {
            if (!currentResults) return;

            const btn = document.getElementById('exportPdf');
            const originalText = btn.textContent;
            btn.textContent = 'â³ PDF ìƒì„± ì¤‘...';
            btn.disabled = true;

            try {
                // PDFìš© HTML ì»¨í…ì¸  ìƒì„±
                const pdfContainer = document.createElement('div');
                pdfContainer.id = 'pdf-export-container';
                pdfContainer.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 800px;
                    background: white;
                    padding: 40px;
                    z-index: 10000;
                    font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
                `;

                const eligibleHtml = currentResults.optimal.combination.length > 0
                    ? currentResults.optimal.combination.map((item, idx) => `
                        <div style="background: #e8f5e9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #4caf50;">
                            <div style="font-weight: bold; color: #2e7d32; margin-bottom: 8px;">${idx + 1}. ${item.subsidy.name}</div>
                            <div style="color: #1565c0; font-size: 15px; margin-bottom: 5px;">ğŸ’° ì˜ˆìƒ ê¸ˆì•¡: ${item.totalAmount.toLocaleString()}ì›</div>
                            <div style="color: #666; font-size: 13px; margin-bottom: 8px;">ğŸ“Š ì‚°ì¶œ: ${item.details}</div>
                            <div style="background: #fff; padding: 10px; border-radius: 6px; margin-top: 8px;">
                                <div style="color: #333; font-size: 12px; margin-bottom: 5px;"><strong>ğŸ“‹ í•„ìš”ì„œë¥˜:</strong> ${item.subsidy.requiredDocuments ? item.subsidy.requiredDocuments.join(', ') : '-'}</div>
                                <div style="color: #333; font-size: 12px; margin-bottom: 5px;"><strong>ğŸ¢ ì‹ ì²­ë°©ë²•:</strong> ${item.subsidy.applicationMethod || '-'}</div>
                                <div style="color: #333; font-size: 12px;"><strong>ğŸ“ ë¬¸ì˜ì²˜:</strong> ${item.subsidy.contact || '-'}</div>
                            </div>
                        </div>
                    `).join('')
                    : '<p style="color: #666; padding: 15px;">ìˆ˜ê¸‰ ê°€ëŠ¥í•œ ì§€ì›ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';

                const notEligibleHtml = currentResults.eligibility.notEligible.map((item, idx) => `
                    <div style="background: #ffebee; padding: 12px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #f44336;">
                        <div style="font-weight: bold; color: #c62828; margin-bottom: 5px;">${idx + 1}. ${item.subsidy.name}</div>
                        <div style="color: #d32f2f; font-size: 12px;">ë¯¸ì¶©ì¡±: ${item.reasons.join(', ')}</div>
                    </div>
                `).join('');

                // ì¤‘ë³µ ì œì™¸ ì§€ì›ê¸ˆ HTML
                const excludedConflictHtml = (currentResults.excludedByConflict || []).length > 0
                    ? (currentResults.excludedByConflict || []).map((item, idx) => `
                        <div style="background: #fff3e0; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #ff9800;">
                            <div style="font-weight: bold; color: #e65100; margin-bottom: 8px;">${idx + 1}. ${item.subsidy.name} <span style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px;">ì¤‘ë³µ ì œì™¸</span></div>
                            <div style="color: #666; font-size: 13px; margin-bottom: 5px;">ğŸ’° ì˜ˆìƒ ê¸ˆì•¡: ${item.totalAmount.toLocaleString()}ì›</div>
                            <div style="color: #e65100; font-size: 13px; margin-bottom: 5px;">âš ï¸ ì œì™¸ ì‚¬ìœ : ${item.excludeReason}</div>
                            <div style="color: #2e7d32; font-size: 13px; font-weight: bold;">âœ… ë” ìœ ë¦¬í•œ ì„ íƒ: '${item.betterOption}' (${item.betterAmount.toLocaleString()}ì›) - +${item.amountDiff.toLocaleString()}ì› ë” ë§ìŒ</div>
                        </div>
                    `).join('')
                    : '';

                pdfContainer.innerHTML = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; margin: -40px -40px 30px -40px; text-align: center;">
                        <h1 style="margin: 0; font-size: 28px;">2026ë…„ ê³ ìš©ì§€ì›ê¸ˆ ë¶„ì„ ê²°ê³¼</h1>
                        <p style="margin: 10px 0 0 0; opacity: 0.9;">Employment Subsidy Analysis Report</p>
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                        <h2 style="color: #333; font-size: 18px; margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #667eea;">ğŸ“‹ ê¸°ì—… ì •ë³´</h2>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr><td style="padding: 8px 0; color: #666; width: 40%;">ì§€ì—­</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.region} (${currentResults.companyData.regionType})</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ì—…ì¢…</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.industry}</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ì´ ì§ì›ìˆ˜</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.totalEmployees}ëª…</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ì²­ë…„ (15~34ì„¸)</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.youthEmployees}ëª…</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ì¤‘ì¥ë…„ (50~59ì„¸)</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.middleAgedEmployees}ëª…</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ê³ ë ¹ì (60ì„¸+)</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.seniorEmployees}ëª…</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ì¥ì• ì¸</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.disabledEmployees}ëª…</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ì¤‘ì¦ì¥ì• ì¸</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.severeDisabledEmployees}ëª…</td></tr>
                            <tr><td style="padding: 8px 0; color: #666;">ìœ¡ì•„ê¸° ê·¼ë¡œì</td><td style="padding: 8px 0; font-weight: 500;">${currentResults.companyData.childcareWorkers}ëª…</td></tr>
                        </table>
                    </div>

                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 25px;">
                        <div style="font-size: 16px; opacity: 0.9;">ì´ ì˜ˆìƒ ìˆ˜ê¸‰ì•¡</div>
                        <div style="font-size: 36px; font-weight: bold; margin: 10px 0;">${currentResults.optimal.totalAmount.toLocaleString()}ì›</div>
                        <div style="font-size: 14px; opacity: 0.8;">ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ ${currentResults.optimal.combination.length}ê°œ</div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h2 style="color: #2e7d32; font-size: 18px; margin: 0 0 15px 0; padding: 10px 15px; background: #e8f5e9; border-radius: 8px;">âœ… ìˆ˜ê¸‰ ê°€ëŠ¥ ì§€ì›ê¸ˆ (${currentResults.optimal.combination.length}ê°œ)</h2>
                        ${eligibleHtml}
                    </div>

                    ${excludedConflictHtml ? `
                    <div style="margin-bottom: 25px;">
                        <h2 style="color: #e65100; font-size: 18px; margin: 0 0 15px 0; padding: 10px 15px; background: #fff3e0; border-radius: 8px;">ğŸ”„ ì¤‘ë³µ ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ (ë” ìœ ë¦¬í•œ ëŒ€ì•ˆ ì„ íƒë¨)</h2>
                        ${excludedConflictHtml}
                        <div style="background: #fff8e1; padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 13px; color: #f57c00;">
                            ğŸ’¡ <strong>ì•ˆë‚´:</strong> ìœ„ ì§€ì›ê¸ˆë“¤ì€ ë‹¤ë¥¸ ì§€ì›ê¸ˆê³¼ ë™ì‹œ ìˆ˜ê¸‰ì´ ë¶ˆê°€í•˜ì—¬, ê¸ˆì•¡ì´ ë” í° ì§€ì›ê¸ˆì„ ì¶”ì²œë“œë ¸ìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                    ` : ''}

                    <div style="margin-bottom: 25px;">
                        <h2 style="color: #c62828; font-size: 18px; margin: 0 0 15px 0; padding: 10px 15px; background: #ffebee; border-radius: 8px;">âŒ ìˆ˜ê¸‰ ë¶ˆê°€ ì§€ì›ê¸ˆ (${currentResults.eligibility.notEligible.length}ê°œ)</h2>
                        ${notEligibleHtml}
                    </div>

                    <div style="margin-bottom: 25px; page-break-before: always;">
                        <h2 style="color: #1565c0; font-size: 18px; margin: 0 0 15px 0; padding: 10px 15px; background: #e3f2fd; border-radius: 8px;">ğŸ“‹ ì‹ ì²­ ì ˆì°¨ ì•ˆë‚´</h2>
                        <div style="background: #fafafa; padding: 20px; border-radius: 8px;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                <tr style="background: #667eea; color: white;">
                                    <td style="padding: 10px; border-radius: 4px 0 0 0; font-weight: bold;">ë‹¨ê³„</td>
                                    <td style="padding: 10px; font-weight: bold;">ë‚´ìš©</td>
                                    <td style="padding: 10px; border-radius: 0 4px 0 0; font-weight: bold;">ë¹„ê³ </td>
                                </tr>
                                <tr style="background: #fff;">
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; font-weight: bold; color: #667eea;">1ë‹¨ê³„</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">ìê²© ìš”ê±´ í™•ì¸</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; color: #666;">ë³¸ ë¶„ì„ê²°ê³¼ ì°¸ì¡°</td>
                                </tr>
                                <tr style="background: #f9f9f9;">
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; font-weight: bold; color: #667eea;">2ë‹¨ê³„</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">í•„ìš” ì„œë¥˜ ì¤€ë¹„</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; color: #666;">ê° ì§€ì›ê¸ˆë³„ í•„ìš”ì„œë¥˜ í™•ì¸</td>
                                </tr>
                                <tr style="background: #fff;">
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; font-weight: bold; color: #667eea;">3ë‹¨ê³„</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">ì˜¨ë¼ì¸/ë°©ë¬¸ ì‹ ì²­</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; color: #666;">ê³ ìš©24 ë˜ëŠ” ê³ ìš©ì„¼í„°</td>
                                </tr>
                                <tr style="background: #f9f9f9;">
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; font-weight: bold; color: #667eea;">4ë‹¨ê³„</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">ì‹¬ì‚¬ ë° ìŠ¹ì¸</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; color: #666;">í†µìƒ 2~4ì£¼ ì†Œìš”</td>
                                </tr>
                                <tr style="background: #fff;">
                                    <td style="padding: 10px; font-weight: bold; color: #667eea;">5ë‹¨ê³„</td>
                                    <td style="padding: 10px;">ì§€ì›ê¸ˆ ì§€ê¸‰</td>
                                    <td style="padding: 10px; color: #666;">ìŠ¹ì¸ í›„ ê³„ì¢Œ ì…ê¸ˆ</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h2 style="color: #ff6f00; font-size: 18px; margin: 0 0 15px 0; padding: 10px 15px; background: #fff3e0; border-radius: 8px;">ğŸ“ ì£¼ìš” ë¬¸ì˜ì²˜</h2>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #eee;">
                                <div style="font-weight: bold; color: #333; margin-bottom: 5px;">ê³ ìš©ë…¸ë™ë¶€ ì½œì„¼í„°</div>
                                <div style="color: #667eea; font-size: 20px; font-weight: bold;">1350</div>
                            </div>
                            <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #eee;">
                                <div style="font-weight: bold; color: #333; margin-bottom: 5px;">í•œêµ­ì¥ì• ì¸ê³ ìš©ê³µë‹¨</div>
                                <div style="color: #667eea; font-size: 20px; font-weight: bold;">1588-1519</div>
                            </div>
                            <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #eee;">
                                <div style="font-weight: bold; color: #333; margin-bottom: 5px;">ê³ ìš©24 í™ˆí˜ì´ì§€</div>
                                <div style="color: #667eea; font-size: 14px; font-weight: bold;">www.work24.go.kr</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h2 style="color: #d32f2f; font-size: 18px; margin: 0 0 15px 0; padding: 10px 15px; background: #ffebee; border-radius: 8px;">âš ï¸ ê³µí†µ ìœ ì˜ì‚¬í•­</h2>
                        <div style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #ffcdd2;">
                            <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 13px; line-height: 1.8;">
                                <li>ì›”í‰ê·  ë³´ìˆ˜ 124ë§Œì› ë¯¸ë§Œ ê·¼ë¡œìëŠ” ëŒ€ë¶€ë¶„ì˜ ì§€ì›ê¸ˆì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</li>
                                <li>ì‚¬ì—…ì£¼ì˜ ë°°ìš°ì, ì§ê³„ ì¡´ë¹„ì†ì€ ì§€ì› ëŒ€ìƒì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</li>
                                <li>ì™¸êµ­ì¸ ê·¼ë¡œìëŠ” F-2, F-5, F-6 ë¹„ì ì†Œì§€ìë§Œ ì§€ì› ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                                <li>ê³ ìš©ë³´í—˜ ê°€ì…ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</li>
                                <li>ê³µê³µê¸°ê´€, ìœ í¥ì£¼ì ì—…, ì‚¬í–‰ì‹œì„¤ì—… ë“±ì€ ì§€ì› ì œì™¸ ì—…ì¢…ì…ë‹ˆë‹¤.</li>
                            </ul>
                        </div>
                    </div>

                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; text-align: center; color: #999; font-size: 12px;">
                        <p>ìƒì„±ì¼ì‹œ: ${new Date().toLocaleDateString('ko-KR')} ${new Date().toLocaleTimeString('ko-KR')}</p>
                        <p style="margin-top: 5px;">â€» ë³¸ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ìˆ˜ê¸‰ ì—¬ë¶€ëŠ” ê³ ìš©ì„¼í„° ì‹¬ì‚¬ë¥¼ í†µí•´ ê²°ì •ë©ë‹ˆë‹¤.</p>
                    </div>
                `;

                document.body.appendChild(pdfContainer);

                // HTMLì„ ìº”ë²„ìŠ¤ë¡œ ë³€í™˜
                const canvas = await html2canvas(pdfContainer, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                // ìº”ë²„ìŠ¤ë¥¼ PDFë¡œ ë³€í™˜
                const { jsPDF } = window.jspdf;
                const imgData = canvas.toDataURL('image/jpeg', 0.95);

                const pdfWidth = 210; // A4 width in mm
                const pdfHeight = 297; // A4 height in mm
                const imgWidth = pdfWidth - 20; // margins
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                const doc = new jsPDF('p', 'mm', 'a4');

                let heightLeft = imgHeight;
                let position = 10;

                // ì²« í˜ì´ì§€
                doc.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
                heightLeft -= (pdfHeight - 20);

                // ì¶”ê°€ í˜ì´ì§€ê°€ í•„ìš”í•œ ê²½ìš°
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight + 10;
                    doc.addPage();
                    doc.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
                    heightLeft -= (pdfHeight - 20);
                }

                // PDF ì €ì¥
                doc.save(`ê³ ìš©ì§€ì›ê¸ˆ_ë¶„ì„ê²°ê³¼_${new Date().toISOString().slice(0,10)}.pdf`);

                // ì„ì‹œ ì»¨í…Œì´ë„ˆ ì œê±°
                document.body.removeChild(pdfContainer);

                btn.textContent = originalText;
                btn.disabled = false;
            } catch (error) {
                console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                // ì„ì‹œ ì»¨í…Œì´ë„ˆê°€ ìˆìœ¼ë©´ ì œê±°
                const container = document.getElementById('pdf-export-container');
                if (container) document.body.removeChild(container);

                btn.textContent = originalText;
                btn.disabled = false;
                alert('PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
    </script>
</body>
</html>
